<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>触类旁通多种框架 | vitepress-demo</title>
    <meta name="description" content="一个vitepree-demo....">
    <link rel="stylesheet" href="/vitepress-demo/assets/style.4780c1f8.css">
    <link rel="modulepreload" href="/vitepress-demo/assets/app.ee052c02.js">
    <link rel="modulepreload" href="/vitepress-demo/assets/advanced-core-knowledage-front-end_qian-duan-kuang-jia_016-chu-lei-pang-tong-duo-zhong-kuang-jia.md.461e9a05.lean.js">
    
    <link rel="icon" href="favicon.ico">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-ca9ccb7e><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-ca9ccb7e data-v-a71a30f1><div class="VPNavBar has-sidebar" data-v-a71a30f1 data-v-a35e6f52><div class="container" data-v-a35e6f52><div class="VPNavBarTitle has-sidebar" data-v-a35e6f52 data-v-d5925166><a class="title" href="/vitepress-demo/" data-v-d5925166><!--[--><!--]--><!--[--><img class="VPImage logo" src="/vitepress-demo/favicon.ico" data-v-e13a1912><!--]--><!--[-->vitepress-demo<!--]--><!--[--><!--]--></a></div><div class="content" data-v-a35e6f52><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a35e6f52 data-v-f83db6ba><span id="main-nav-aria-label" class="visually-hidden" data-v-f83db6ba>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/vitepress-demo/typora/" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->笔记<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/vitepress-demo/http-protocol/" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->透视 HTTP 协议<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/vitepress-demo/front-spec/" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->前端规范<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/vitepress-demo/javascript-design-model/" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->设计模式<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/vitepress-demo/road-to-react-chinese/" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->React之路<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/vitepress-demo/advanced-core-knowledage-front-end/" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->前端进阶<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/vitepress-demo/about/" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->关于<!--]--><!----></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 相关文档 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="https://staging-cn.vuejs.org/" target="_blank" rel="noreferrer" data-v-e8e0fb1d data-v-3c355974><!--[-->vue<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-3c355974><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="https://www.electronjs.org/" target="_blank" rel="noreferrer" data-v-e8e0fb1d data-v-3c355974><!--[-->electron<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-3c355974><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="https://cn.vitejs.dev/" target="_blank" rel="noreferrer" data-v-e8e0fb1d data-v-3c355974><!--[-->vite<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-3c355974><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="https://process1024.github.io/vitepress/" target="_blank" rel="noreferrer" data-v-e8e0fb1d data-v-3c355974><!--[-->vite中文版(大佬翻译)<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-3c355974><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="https://www.rollupjs.com/" target="_blank" rel="noreferrer" data-v-e8e0fb1d data-v-3c355974><!--[-->rollup<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-3c355974><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="https://www.electron.build/" target="_blank" rel="noreferrer" data-v-e8e0fb1d data-v-3c355974><!--[-->electron-builder<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-3c355974><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="https://router.vuejs.org/zh/" target="_blank" rel="noreferrer" data-v-e8e0fb1d data-v-3c355974><!--[-->vue-router<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-3c355974><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="https://pinia.vuejs.org/" target="_blank" rel="noreferrer" data-v-e8e0fb1d data-v-3c355974><!--[-->pinia<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-3c355974><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="https://vueuse.org/" target="_blank" rel="noreferrer" data-v-e8e0fb1d data-v-3c355974><!--[-->vueuse<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-3c355974><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 1.0.0 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="https://zh-sky.gitee.io/electron-vue-template-doc/" target="_blank" rel="noreferrer" data-v-e8e0fb1d data-v-3c355974><!--[-->友情连接/sky<!--]--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" height="24px" viewbox="0 0 24 24" width="24px" class="icon" data-v-3c355974><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5H9z"></path></svg></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a35e6f52 data-v-a3e7452b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-a3e7452b data-v-968780f1 data-v-086e8519><span class="check" data-v-086e8519><span class="icon" data-v-086e8519><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-968780f1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-968780f1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-a35e6f52 data-v-738bef5a data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/GA23187/vitepress-demo" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-a35e6f52 data-v-e89b88d7 data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6ffb57d3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6ffb57d3><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><!----><!--[--><!--[--><!----><div class="group" data-v-e89b88d7><div class="item appearance" data-v-e89b88d7><p class="label" data-v-e89b88d7>Appearance</p><div class="appearance-action" data-v-e89b88d7><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-e89b88d7 data-v-968780f1 data-v-086e8519><span class="check" data-v-086e8519><span class="icon" data-v-086e8519><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-968780f1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-968780f1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-e89b88d7><div class="item social-links" data-v-e89b88d7><div class="VPSocialLinks social-links-list" data-v-e89b88d7 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/GA23187/vitepress-demo" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a35e6f52 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-ca9ccb7e data-v-aac27d5e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-aac27d5e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-aac27d5e><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-aac27d5e>Menu</span></button><a class="top-link" href="#" data-v-aac27d5e> Return to top </a></div><aside class="VPSidebar" data-v-ca9ccb7e data-v-f332cb62><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-f332cb62><span class="visually-hidden" id="sidebar-aria-label" data-v-f332cb62> Sidebar Navigation </span><!--[--><div class="group" data-v-f332cb62><section class="VPSidebarGroup" data-v-f332cb62 data-v-2976c796><div class="title" data-v-2976c796><h2 class="title-text" data-v-2976c796>如何突破前端开发技术瓶颈</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/0-ru-he-tu-po-qian-duan-kai-fa-ji-shu-ping-jing.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>如何突破前端开发技术瓶颈</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup" data-v-f332cb62 data-v-2976c796><div class="title" data-v-2976c796><h2 class="title-text" data-v-2976c796>大话社区和一名技术者的自我修养</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/050-da-hua-she-qu-he-yi-ming-ji-shu-zhe-de-zi-wo-xiu-yang.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>大话社区和一名技术者的自我修养</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup" data-v-f332cb62 data-v-2976c796><div class="title" data-v-2976c796><h2 class="title-text" data-v-2976c796>JavaScript 基础强化</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/javascript-ji-chu-qiang-hua/001-yi-wang-da-jin-this-dui-zhi-hang-shang-xia-wen-shuo-yes.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>一网打尽 this，对执行上下文说 Yes</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/javascript-ji-chu-qiang-hua/002-lao-si-ji-ye-hui-zai-bi-bao-xiang-guan-zhi-shi-dian-fan-che-shang.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>老司机也会在闭包相关知识点翻车（上）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/javascript-ji-chu-qiang-hua/003-lao-si-ji-ye-hui-zai-bi-bao-xiang-guan-zhi-shi-dian-fan-che-xia.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>老司机也会在闭包相关知识点翻车（下）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/javascript-ji-chu-qiang-hua/004-wo-men-bu-bei-song-api-zhi-shi-xian-api.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>我们不背诵 API，只实现 API</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/javascript-ji-chu-qiang-hua/005javascript-zhi-shi-tu-pu-he-gao-pin-kao-dian-shu-li.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>JavaScript 知识图谱和高频考点梳理</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/javascript-ji-chu-qiang-hua/006-qi-ta-ji-chu-ti-ku.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>其他基础题库</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup" data-v-f332cb62 data-v-2976c796><div class="title" data-v-2976c796><h2 class="title-text" data-v-2976c796>JavaScript 语言进阶</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/javascript-yu-yan-jin-jie/007-yi-bu-bu-ke-pa-si-ji-ying-bei-shi-jian-na-xia-shang.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>异步不可怕“死记硬背”+ 实践拿下（上)</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/javascript-yu-yan-jin-jie/008-yi-bu-bu-ke-pa-si-ji-ying-bei-shi-jian-na-xia-xia.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>异步不可怕“死记硬背”+ 实践拿下（下）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/javascript-yu-yan-jin-jie/009-ni-yi-wei-wo-zhen-de-xiang-rang-ni-shou-xie-promise-ma-shang.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>你以为我真的想让你手写 Promise 吗（上）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/javascript-yu-yan-jin-jie/010-ni-yi-wei-wo-zhen-de-xiang-rang-ni-shou-xie-promise-ma-xia.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>你以为我真的想让你手写 Promise 吗（下）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/javascript-yu-yan-jin-jie/011-mian-xiang-dui-xiang-he-yuan-xing-yong-bu-guo-shi-de-hua-ti.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>面向对象和原型——永不过时的话题</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/javascript-yu-yan-jin-jie/012-jiu-jing-gai-ru-he-xue-xi-yu-shi-ju-jin-de-es.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>究竟该如何学习与时俱进的 ES</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup" data-v-f332cb62 data-v-2976c796><div class="title" data-v-2976c796><h2 class="title-text" data-v-2976c796>不可忽视的 HTML 和 CSS</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/bu-ke-hu-shi-de-html-he-css/013-qian-duan-mian-shi-li-bu-kai-de-mian-zi-gong-cheng.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>前端面试离不开的“面子工程”</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/bu-ke-hu-shi-de-html-he-css/014-jin-ji-de-css-he-html.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>进击的 CSS 和 HTML</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/bu-ke-hu-shi-de-html-he-css/015-xiang-ying-shi-bu-ju-he-bootstrap-de-shi-xian-fen-xi.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>响应式布局和 Bootstrap 的实现分析</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup" data-v-f332cb62 data-v-2976c796><div class="title" data-v-2976c796><h2 class="title-text" data-v-2976c796>前端框架</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link active" href="/vitepress-demo/advanced-core-knowledage-front-end/qian-duan-kuang-jia/016-chu-lei-pang-tong-duo-zhong-kuang-jia.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>触类旁通多种框架</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/qian-duan-kuang-jia/017-ni-zhen-de-dong-react-ma.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>你真的懂 React 吗</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/qian-duan-kuang-jia/018-jie-mi-react-zhen-di-zu-jian-she-ji.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>揭秘 React 真谛：组件设计</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/qian-duan-kuang-jia/019-jie-mi-react-zhen-di-shu-ju-zhuang-tai-guan-li.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>揭秘 React 真谛：数据状态管理</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/qian-duan-kuang-jia/020react-de-xian-zhuang-yu-wei-lai.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>React 的现状与未来</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/qian-duan-kuang-jia/021-tong-gou-ying-yong-zhong-ni-suo-hu-lve-de-xi-jie.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>同构应用中你所忽略的细节</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/qian-duan-kuang-jia/022-cong-kuang-jia-he-lei-ku-wo-men-gai-xue-dao-shi-mo.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>从框架和类库，我们该学到什么</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup" data-v-f332cb62 data-v-2976c796><div class="title" data-v-2976c796><h2 class="title-text" data-v-2976c796>前端工程化</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/qian-duan-gong-cheng-hua/023-shen-ru-qian-chu-mo-kuai-hua-han-treeshaking-shang.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>深入浅出模块化（含 tree shaking）（上）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/qian-duan-gong-cheng-hua/024-shen-ru-qian-chu-mo-kuai-hua-han-treeshaking-xia.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>深入浅出模块化（含 tree shaking）（下）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/qian-duan-gong-cheng-hua/025webpack-gong-cheng-shi-he-qian-duan-gong-cheng-shi-shang.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>webpack 工程师和前端工程师（上）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/qian-duan-gong-cheng-hua/026webpack-gong-cheng-shi-he-qian-duan-gong-cheng-shi-xia.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>webpack 工程师和前端工程师（下）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/qian-duan-gong-cheng-hua/027-qian-duan-gong-cheng-hua-bei-hou-de-xiang-mu-zu-zhi-she-ji-shang.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>前端工程化背后的项目组织设计（上)</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/qian-duan-gong-cheng-hua/028-qian-duan-gong-cheng-hua-bei-hou-de-xiang-mu-zu-zhi-she-ji-xia.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>前端工程化背后的项目组织设计（下)</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/qian-duan-gong-cheng-hua/029-dai-ma-gui-fan-gong-ju-ji-bei-hou-ji-shu-she-ji-shang.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>代码规范工具及背后技术设计（上）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/qian-duan-gong-cheng-hua/030-dai-ma-gui-fan-gong-ju-ji-bei-hou-ji-shu-she-ji-xia.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>代码规范工具及背后技术设计（下）</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup" data-v-f332cb62 data-v-2976c796><div class="title" data-v-2976c796><h2 class="title-text" data-v-2976c796>性能优化</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/xing-neng-you-hua/031-xing-neng-jian-kong-he-cuo-wu-shou-ji-yu-shang-bao-shang.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>性能监控和错误收集与上报（上）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/xing-neng-you-hua/032-xing-neng-jian-kong-he-cuo-wu-shou-ji-yu-shang-bao-xia.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>性能监控和错误收集与上报（下）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/xing-neng-you-hua/033-xing-neng-you-hua-wen-ti-lao-si-ji-ru-he-jie-jue-shang.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>性能优化问题，老司机如何解决（上）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/xing-neng-you-hua/034-xing-neng-you-hua-wen-ti-lao-si-ji-ru-he-jie-jue-xia.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>性能优化问题，老司机如何解决（下）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/xing-neng-you-hua/035-yi-react-wei-li-shuo-shuo-kuang-jia-he-xing-neng-shang.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>以 React 为例，说说框架和性能（上）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/xing-neng-you-hua/036-yi-react-wei-li-shuo-shuo-kuang-jia-he-xing-neng-xia.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>以 React 为例，说说框架和性能（下）</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup" data-v-f332cb62 data-v-2976c796><div class="title" data-v-2976c796><h2 class="title-text" data-v-2976c796>编程思维和算法</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/bian-cheng-si-wei-he-suan-fa/037-jie-mi-qian-duan-she-ji-mo-shi-shang.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>揭秘前端设计模式（上）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/bian-cheng-si-wei-he-suan-fa/038-jie-mi-qian-duan-she-ji-mo-shi-xia.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>揭秘前端设计模式（下）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/bian-cheng-si-wei-he-suan-fa/039-pou-xi-wu-chu-bu-zai-de-shu-ju-jie-gou.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>剖析无处不在的数据结构</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/bian-cheng-si-wei-he-suan-fa/040-gu-lao-you-xin-chao-de-han-shu-shi.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>古老又新潮的函数式</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/bian-cheng-si-wei-he-suan-fa/041-na-xie-nian-chang-kao-de-qian-duan-suan-fa-shang.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>那些年常考的前端算法（上）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/bian-cheng-si-wei-he-suan-fa/042-na-xie-nian-chang-kao-de-qian-duan-suan-fa-zhong.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>那些年常考的前端算法（中）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/bian-cheng-si-wei-he-suan-fa/043-na-xie-nian-chang-kao-de-qian-duan-suan-fa-xia.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>那些年常考的前端算法（下）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/bian-cheng-si-wei-he-suan-fa/044-fen-xi-yi-dao-wei-xin-mian-shi-ti.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>分析一道“微信”面试题</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup" data-v-f332cb62 data-v-2976c796><div class="title" data-v-2976c796><h2 class="title-text" data-v-2976c796>网络知识</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/wang-luo-zhi-shi/045-li-bu-kai-de-wang-luo-ji-chu.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>离不开的网络基础</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/wang-luo-zhi-shi/046-huan-cun-shui-du-dong-yi-wen-du-ya-ba-shang.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>缓存谁都懂，一问都哑巴（上）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/wang-luo-zhi-shi/047-huan-cun-shui-du-dong-yi-wen-du-ya-ba-xia.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>缓存谁都懂，一问都哑巴（下）</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/wang-luo-zhi-shi/048http-de-shen-si-wo-cong-he-er-lai-qu-xiang-he-chu.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>HTTP 的深思：我从何而来，去向何处</span><!----><!--]--><!----></a><a class="VPLink link link" href="/vitepress-demo/advanced-core-knowledage-front-end/wang-luo-zhi-shi/049-bu-ke-hu-shi-de-qian-duan-an-quan-dan-ye-ying-yong-jian-quan-she-ji.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>不可忽视的前端安全 - 单页应用鉴权设计</span><!----><!--]--><!----></a><!--]--></div></section></div><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-ca9ccb7e data-v-c95df128><div class="VPDoc has-sidebar has-aside" data-v-c95df128 data-v-f0af2311><div class="container" data-v-f0af2311><div class="aside" data-v-f0af2311><div class="aside-curtain" data-v-f0af2311></div><div class="aside-container" data-v-f0af2311><div class="aside-content" data-v-f0af2311><div class="VPDocAside" data-v-f0af2311 data-v-aea49c31><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline has-outline" data-v-aea49c31 data-v-a3de185c><div class="content" data-v-a3de185c><div class="outline-marker" data-v-a3de185c></div><div class="outline-title" data-v-a3de185c>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-a3de185c><span class="visually-hidden" id="doc-outline-aria-label" data-v-a3de185c> Table of Contents for current page </span><ul class="root" data-v-a3de185c><!--[--><li data-v-a3de185c><a class="outline-link" href="#响应式框架基本原理" data-v-a3de185c>响应式框架基本原理</a><!----></li><li data-v-a3de185c><a class="outline-link" href="#模版编译原理介绍" data-v-a3de185c>模版编译原理介绍</a><!----></li><li data-v-a3de185c><a class="outline-link" href="#发布订阅模式简单应用" data-v-a3de185c>发布订阅模式简单应用</a><!----></li><li data-v-a3de185c><a class="outline-link" href="#mvvm-融会贯通" data-v-a3de185c>MVVM 融会贯通</a><!----></li><li data-v-a3de185c><a class="outline-link" href="#揭秘虚拟-dom" data-v-a3de185c>揭秘虚拟 DOM</a><!----></li><li data-v-a3de185c><a class="outline-link" href="#总结" data-v-a3de185c>总结</a><!----></li><li data-v-a3de185c><a class="outline-link" href="#分享交流" data-v-a3de185c>分享交流</a><!----></li><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-aea49c31></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-f0af2311><div class="content-container" data-v-f0af2311><!--[--><!--[--><!--[--><span class="page-info">✍️</span><span class="page-info">🕐</span><span> 🔗 <!--[--><!--]--></span><!--]--><!--]--><!--]--><main class="main" data-v-f0af2311><div style="position:relative;" class="vp-doc _vitepress-demo_advanced-core-knowledage-front-end_qian-duan-kuang-jia_016-chu-lei-pang-tong-duo-zhong-kuang-jia" data-v-f0af2311><div><h1 id="触类旁通多种框架" tabindex="-1">触类旁通多种框架 <a class="header-anchor" href="#触类旁通多种框架" aria-hidden="true">#</a></h1><p>框架在任何一种语言编程范畴中都扮演了举足轻重的地位，前端尤是如此。目前流行的前端框架三驾马车：Angular、React 和 Vue，它们各有特点和受众，都值得开发者认真思考和学习。那么我们在精力有限的情况下，如何做到“触类旁通”、如何提取框架共性、提高学习和应用效率呢？</p><p>我们这一讲就来剖析这些框架的特点和本质，介绍如何学习并使用这些框架，进而了解前端框架的真谛。</p><p>相关知识点如下：</p><p><img src="https://images.gitbook.cn/ff71bef0-9234-11e9-b195-bf69c03485a0" alt=""></p><p>我把现代框架的关键词进行提炼，掌握这些关键词，是我们学习的重要环节。这些关键词有：双向绑定、依赖收集、发布订阅模式、MVVM / MVC、虚拟 DOM、虚拟 DOM diff、模版编译等。</p><h3 id="响应式框架基本原理" tabindex="-1">响应式框架基本原理 <a class="header-anchor" href="#响应式框架基本原理" aria-hidden="true">#</a></h3><p>我们不再赘述响应式或数据双向绑定的基本概念，这里直接思考其行为：直观上，数据在变化时，不再需要开发者去手动更新视图，而视图会根据变化的数据“自动”进行更新。想完成这个过程，我们需要：</p><ul><li>收集视图依赖了哪些数据</li><li>感知被依赖数据的变化</li><li>数据变化时，自动“通知”需要更新的视图部分，并进行更新</li></ul><p>道理很简单，这个思考过程换成对应的技术概念就是：</p><ul><li>依赖收集</li><li>数据劫持 / 数据代理</li><li>发布订阅模式</li></ul><p>接下来，我们一步步拆解。</p><h4 id="数据劫持与代理" tabindex="-1">数据劫持与代理 <a class="header-anchor" href="#数据劫持与代理" aria-hidden="true">#</a></h4><p>感知数据变化的方法很直接，就是进行数据劫持或数据代理。我们往往通过 Object.defineProperty 实现。这个方法可以定义数据的 getter 和 setter，具体用法不再赘述。下面来看一个场景：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">let data = {</span></span>
<span class="line"><span style="color:#A6ACCD;">  stage: &#39;GitChat&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  course: {</span></span>
<span class="line"><span style="color:#A6ACCD;">    title: &#39;前端开发进阶&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">    author: &#39;Lucas&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">    publishTime: &#39;2018 年 5 月&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">Object.keys(data).forEach(key =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  let currentValue = data[key]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  Object.defineProperty(data, key, {</span></span>
<span class="line"><span style="color:#A6ACCD;">    enumerable: true,</span></span>
<span class="line"><span style="color:#A6ACCD;">    configurable: false,</span></span>
<span class="line"><span style="color:#A6ACCD;">    get() {</span></span>
<span class="line"><span style="color:#A6ACCD;">      console.log(`getting ${key} value now, getting value is:`, currentValue)</span></span>
<span class="line"><span style="color:#A6ACCD;">      return currentValue</span></span>
<span class="line"><span style="color:#A6ACCD;">    },</span></span>
<span class="line"><span style="color:#A6ACCD;">    set(newValue) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      currentValue = newValue</span></span>
<span class="line"><span style="color:#A6ACCD;">      console.log(`setting ${key} value now, setting value is`, currentValue)</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  })</span></span>
<span class="line"><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>这段代码对 data 数据的 getter 和 setter 进行定义拦截，当我们读取或者改变 data 的值时：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">data.course</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">// getting course value now, getting value is: {title: &quot;前端开发进阶&quot;, author: &quot;Lucas&quot;, publishTime: &quot;2018 年 5 月&quot;}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">data.course = &#39;前端开发进阶2&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">// setting course value now, setting value is 前端开发进阶2</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>但是这种实现有一个问题，例如：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">data.course.title = &#39;前端开发进阶2&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">// getting course value now, getting value is: {title: &quot;前端开发进阶&quot;, author: &quot;Lucas&quot;, publishTime: &quot;2018 年 5 月&quot;}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>只会有 getting course value now, getting value is: {title: &quot;前端开发进阶&quot;, author: &quot;Lucas&quot;, publishTime: &quot;2018 年 5 月&quot;} 的输出，这是因为我们尝试读取了 data.course 信息。但是修改 data.course.title 的信息并没有打印出来。</p><p>出现这个问题的原因是因为我们的实现代码只进行了一层 Object.defineProperty，或者说只对 data 的第一层属性进行了 Object.defineProperty，对于嵌套的引用类型数据结构：data.course，我们同样应该进行拦截。</p><p>为了达到深层拦截的目的，将 Object.defineProperty 的逻辑抽象为 observe 函数，并改用递归实现：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">let data = {</span></span>
<span class="line"><span style="color:#A6ACCD;">  stage: &#39;GitChat&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  course: {</span></span>
<span class="line"><span style="color:#A6ACCD;">    title: &#39;前端开发进阶&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">    author: &#39;Lucas&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">    publishTime: &#39;2018 年 5 月&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const observe = data =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (!data || typeof data !== &#39;object&#39;) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      return</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  Object.keys(data).forEach(key =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">    let currentValue = data[key]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    observe(currentValue)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    Object.defineProperty(data, key, {</span></span>
<span class="line"><span style="color:#A6ACCD;">      enumerable: true,</span></span>
<span class="line"><span style="color:#A6ACCD;">      configurable: false,</span></span>
<span class="line"><span style="color:#A6ACCD;">      get() {</span></span>
<span class="line"><span style="color:#A6ACCD;">        console.log(`getting ${key} value now, getting value is:`, currentValue)</span></span>
<span class="line"><span style="color:#A6ACCD;">        return currentValue</span></span>
<span class="line"><span style="color:#A6ACCD;">      },</span></span>
<span class="line"><span style="color:#A6ACCD;">      set(newValue) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        currentValue = newValue</span></span>
<span class="line"><span style="color:#A6ACCD;">        console.log(`setting ${key} value now, setting value is`, currentValue)</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">  })</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">observe(data)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>这样一来，就实现了深层数据拦截：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">data.course.title = &#39;前端开发进阶2&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">// getting course value now, getting value is: {// ...}</span></span>
<span class="line"><span style="color:#A6ACCD;">// setting title value now, setting value is 前端开发进阶2</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>请注意，我们在 set 代理中，并没有对 newValue 再次递归进行 observe(newValue)。也就是说，如果赋值是一个引用类型：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">data.course.title = {</span></span>
<span class="line"><span style="color:#A6ACCD;">    title: &#39;前端开发进阶2&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>无法实现对 data.course.title 数据的观察。这里为了简化学习成本，默认修改的数值符合语义，都是基本类型。</p><p>在尝试对 data.course.title 赋值时，首先会读取 data.course，因此输出：getting course value now, getting value is: {// ...}，赋值后，触发 data.course.title 的 setter，输出：setting title value now, setting value is 前端开发进阶 2。</p><p>因此我们总结出：对数据进行拦截并不复杂，这也是很多框架实现的第一步。</p><h4 id="监听数组变化" tabindex="-1">监听数组变化 <a class="header-anchor" href="#监听数组变化" aria-hidden="true">#</a></h4><p>如果上述数据中某一项变为数组：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">let data = {</span></span>
<span class="line"><span style="color:#A6ACCD;">  stage: &#39;GitChat&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  course: {</span></span>
<span class="line"><span style="color:#A6ACCD;">    title: &#39;前端开发进阶&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">    author: [&#39;Lucas&#39;, &#39;Ronaldo&#39;],</span></span>
<span class="line"><span style="color:#A6ACCD;">    publishTime: &#39;2018 年 5 月&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const observe = data =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (!data || typeof data !== &#39;object&#39;) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      return</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  Object.keys(data).forEach(key =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">    let currentValue = data[key]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    observe(currentValue)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    Object.defineProperty(data, key, {</span></span>
<span class="line"><span style="color:#A6ACCD;">      enumerable: true,</span></span>
<span class="line"><span style="color:#A6ACCD;">      configurable: false,</span></span>
<span class="line"><span style="color:#A6ACCD;">      get() {</span></span>
<span class="line"><span style="color:#A6ACCD;">        console.log(`getting ${key} value now, getting value is:`, currentValue)</span></span>
<span class="line"><span style="color:#A6ACCD;">        return currentValue</span></span>
<span class="line"><span style="color:#A6ACCD;">      },</span></span>
<span class="line"><span style="color:#A6ACCD;">      set(newValue) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        currentValue = newValue</span></span>
<span class="line"><span style="color:#A6ACCD;">        console.log(`setting ${key} value now, setting value is`, currentValue)</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">  })</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">observe(data)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">data.course.author.push(&#39;Messi&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">// getting course value now, getting value is: {//...}</span></span>
<span class="line"><span style="color:#A6ACCD;">// getting author value now, getting value is: (2) [(...), (...)]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>我们只监听到了 data.course 以及 data.course.author 的读取，而数组 push 行为并没有被拦截。这是因为 Array.prototype 上挂载的方法并不能触发 data.course.author 属性值的 setter，由于这并不属于做赋值操作，而是 push API 调用操作。然而对于框架实现来说，这显然是不满足要求的，当数组变化时我们应该也有所感知。</p><p>Vue 同样存在这样的问题，它的解决方法是：将数组的常用方法进行重写，进而覆盖掉原生的数组方法，重写之后的数组方法需要能够被拦截。</p><p>实现逻辑如下：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">const arrExtend = Object.create(Array.prototype)</span></span>
<span class="line"><span style="color:#A6ACCD;">const arrMethods = [</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;push&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;pop&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;shift&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;unshift&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;splice&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;sort&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;reverse&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">arrMethods.forEach(method =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  const oldMethod = Array.prototype[method]</span></span>
<span class="line"><span style="color:#A6ACCD;">  const newMethod = function(...args) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    oldMethod.apply(this, args)</span></span>
<span class="line"><span style="color:#A6ACCD;">    console.log(`${method} 方法被执行了`)</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  arrExtend[method] = newMethod</span></span>
<span class="line"><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>对于数组原生的 7 个方法：</p><ul><li>push</li><li>pop</li><li>shift</li><li>unshift</li><li>splice</li><li>sort</li><li>reverse</li></ul><p>进行重写，核心操作还是调用原生方法：oldMethod.apply(this, args)，除此之外可以在调用 oldMethod.apply(this, args) 前后加入我们需要的任何逻辑。示例代码中加入了一行 console.log。使用时：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">Array.prototype = Object.assign(Array.prototype, arrExtend)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">let array = [1, 2, 3]</span></span>
<span class="line"><span style="color:#A6ACCD;">array.push(4)</span></span>
<span class="line"><span style="color:#A6ACCD;">// push 方法被执行了</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>对应我们的代码：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">const arrExtend = Object.create(Array.prototype)</span></span>
<span class="line"><span style="color:#A6ACCD;">const arrMethods = [</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;push&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;pop&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;shift&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;unshift&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;splice&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;sort&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;reverse&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">arrMethods.forEach(method =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  const oldMethod = Array.prototype[method]</span></span>
<span class="line"><span style="color:#A6ACCD;">  const newMethod = function(...args) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    oldMethod.apply(this, args)</span></span>
<span class="line"><span style="color:#A6ACCD;">    console.log(`${method} 方法被执行了`)</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  arrExtend[method] = newMethod</span></span>
<span class="line"><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">Array.prototype = Object.assign(Array.prototype, arrExtend)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">let data = {</span></span>
<span class="line"><span style="color:#A6ACCD;">  stage: &#39;GitChat&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  course: {</span></span>
<span class="line"><span style="color:#A6ACCD;">    title: &#39;前端开发进阶&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">    author: [&#39;Lucas&#39;, &#39;Ronaldo&#39;],</span></span>
<span class="line"><span style="color:#A6ACCD;">    publishTime: &#39;2018 年 5 月&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const observe = data =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (!data || typeof data !== &#39;object&#39;) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      return</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  Object.keys(data).forEach(key =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">    let currentValue = data[key]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    observe(currentValue)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    Object.defineProperty(data, key, {</span></span>
<span class="line"><span style="color:#A6ACCD;">      enumerable: true,</span></span>
<span class="line"><span style="color:#A6ACCD;">      configurable: false,</span></span>
<span class="line"><span style="color:#A6ACCD;">      get() {</span></span>
<span class="line"><span style="color:#A6ACCD;">        console.log(`getting ${key} value now, getting value is:`, currentValue)</span></span>
<span class="line"><span style="color:#A6ACCD;">        return currentValue</span></span>
<span class="line"><span style="color:#A6ACCD;">      },</span></span>
<span class="line"><span style="color:#A6ACCD;">      set(newValue) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        currentValue = newValue</span></span>
<span class="line"><span style="color:#A6ACCD;">        console.log(`setting ${key} value now, setting value is`, currentValue)</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">  })</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">observe(data)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">data.course.author.push(&#39;Messi&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><p>将会输出：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">getting course value now, getting value is: {//...}</span></span>
<span class="line"><span style="color:#A6ACCD;">getting author value now, getting value is: (2) [(...), (...)]</span></span>
<span class="line"><span style="color:#A6ACCD;">// push 方法被执行了</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这种 monkey patch 本质是重写原生方法，这天生不是很安全，也很不优雅，能有更好的实现吗？</p><p>答案是有的，使用 ES Next 的新特性——Proxy，之前也介绍过，它可以完成对数据的代理。</p><p>那么这两种方式有何区别呢？请继续阅读。</p><h4 id="object-defineproperty-vs-proxy" tabindex="-1">Object.defineProperty VS Proxy <a class="header-anchor" href="#object-defineproperty-vs-proxy" aria-hidden="true">#</a></h4><p>我们首先尝试使用 Proxy 来完成代码重构：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">let data = {</span></span>
<span class="line"><span style="color:#A6ACCD;">  stage: &#39;GitChat&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  course: {</span></span>
<span class="line"><span style="color:#A6ACCD;">    title: &#39;前端开发进阶&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">    author: [&#39;Lucas&#39;],</span></span>
<span class="line"><span style="color:#A6ACCD;">    publishTime: &#39;2018 年 5 月&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const observe = data =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (!data || Object.prototype.toString.call(data) !== &#39;[object Object]&#39;) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      return</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  Object.keys(data).forEach(key =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">    let currentValue = data[key]</span></span>
<span class="line"><span style="color:#A6ACCD;">    // 事实上 proxy 也可以对函数类型进行代理。这里只对承载数据类型的 object 进行处理，读者了解即可。</span></span>
<span class="line"><span style="color:#A6ACCD;">    if (typeof currentValue === &#39;object&#39;) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      observe(currentValue)</span></span>
<span class="line"><span style="color:#A6ACCD;">      data[key] = new Proxy(currentValue, {</span></span>
<span class="line"><span style="color:#A6ACCD;">        set(target, property, value, receiver) {</span></span>
<span class="line"><span style="color:#A6ACCD;">          // 因为数组的 push 会引起 length 属性的变化，所以 push 之后会触发两次 set 操作，我们只需要保留一次即可，property 为 length 时，忽略</span></span>
<span class="line"><span style="color:#A6ACCD;">          if (property !== &#39;length&#39;) {</span></span>
<span class="line"><span style="color:#A6ACCD;">            console.log(`setting ${key} value now, setting value is`, currentValue)</span></span>
<span class="line"><span style="color:#A6ACCD;">          }</span></span>
<span class="line"><span style="color:#A6ACCD;">          return Reflect.set(target, property, value, receiver)</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">      })</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    else {</span></span>
<span class="line"><span style="color:#A6ACCD;">      Object.defineProperty(data, key, {</span></span>
<span class="line"><span style="color:#A6ACCD;">        enumerable: true,</span></span>
<span class="line"><span style="color:#A6ACCD;">        configurable: false,</span></span>
<span class="line"><span style="color:#A6ACCD;">        get() {</span></span>
<span class="line"><span style="color:#A6ACCD;">          console.log(`getting ${key} value now, getting value is:`, currentValue)</span></span>
<span class="line"><span style="color:#A6ACCD;">          return currentValue</span></span>
<span class="line"><span style="color:#A6ACCD;">        },</span></span>
<span class="line"><span style="color:#A6ACCD;">        set(newValue) {</span></span>
<span class="line"><span style="color:#A6ACCD;">          currentValue = newValue</span></span>
<span class="line"><span style="color:#A6ACCD;">          console.log(`setting ${key} value now, setting value is`, currentValue)</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">      })</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  })</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">observe(data)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>此时对数组进行操作：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">data.course.author.push(&#39;messi&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">// setting author value now, setting value is [&quot;Lucas&quot;]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>已经符合我们的需求了。注意这里在使用 Proxy 进行代理时，并没有对 getter 进行代理，因此上述代码的输出结果并不像之前使用 Object.defineProperty 那样也会有 getting value 输出。</p><p>整体实现并不难理解，需要读者了解最基本的 Proxy 知识。简单总结一下，对于数据键值为基本类型的情况，我们使用 Object.defineProperty；对于键值为对象类型的情况，继续递归调用 observe 方法，并通过 Proxy 返回的新对象对 data[key] 重新赋值，这个新值的 getter 和 setter 已经被添加了代理。</p><p>了解了 Proxy 实现之后，我们对 Proxy 实现数据代理和 Object.defineProperty 实现数据拦截进行对比，会发现：</p><ul><li>Object.defineProperty 不能监听数组的变化，需要进行数组方法的重写</li><li>Object.defineProperty 必须遍历对象的每个属性，且对于嵌套结构需要深层遍历</li><li>Proxy 的代理是针对整个对象的，而不是对象的某个属性，因此不同于 Object.defineProperty 的必须遍历对象每个属性，Proxy 只需要做一层代理就可以监听同级结构下的所有属性变化，当然对于深层结构，递归还是需要进行的</li><li>Proxy 支持代理数组的变化</li><li>Proxy 的第二个参数除了 set 和 get 以外，可以有 13 种拦截方法，比起 Object.defineProperty() 更加强大，这里不再一一列举</li><li>Proxy 性能将会被底层持续优化，而 Object.defineProperty 已经不再是优化重点</li></ul><h3 id="模版编译原理介绍" tabindex="-1">模版编译原理介绍 <a class="header-anchor" href="#模版编译原理介绍" aria-hidden="true">#</a></h3><p>到此，我们了解了如何监听数据的变化，那么下一步呢？以类 Vue 框架为例，我们看看一个典型的用法：</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">app</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">{{stage}} 平台课程：{{course.title}}</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">{{course.title}} 是 {{course.author}} 发布的课程</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">发布时间为 {{course.publishTime}}</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> vue </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Vue</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ele</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">stage</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GitChat</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">course</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">前端开发进阶</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">author</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Lucas</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">publishTime</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2018 年 5 月</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>其中模版变量使用了 的表达方式输出模版变量。最终输出的 HTML 内容应该被合适的数据进行填充替换，因此还需要一步编译过程，该过程任何框架或类库中都是相通的，比如 React 中的 JSX，也是编译为 React.createElement，并在生成虚拟 DOM 时进行数据填充。</p><p>我们这里简化过程，将模版内容输出为真实 HTML 即可。</p><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">app</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">{{stage}} 平台课程：{{course.title}}</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">{{course.title}} 是 {{course.author}} 发布的课程</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">发布时间为 {{course.publishTime}}</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="模版编译实现" tabindex="-1">模版编译实现 <a class="header-anchor" href="#模版编译实现" aria-hidden="true">#</a></h4><p>一提到这样的“模版编译”过程，很多开发者都会想到词法分析，也许都会感到头大。其实原理很简单，就是使用正则 + 遍历，有时也需要一些算法知识，我们来看现在的场景，只需要对 #app 节点下内容进行替换，通过正则识别出模版变量，获取对应的数据即可：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">compile(document.querySelector(&#39;#app&#39;), data)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">function compile(el, data) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  let fragment = document.createDocumentFragment()</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  while (child = el.firstChild) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    fragment.appendChild(child)</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  // 对 el 里面的内容进行替换</span></span>
<span class="line"><span style="color:#A6ACCD;">  function replace(fragment) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    Array.from(fragment.childNodes).forEach(node =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">      let textContent = node.textContent</span></span>
<span class="line"><span style="color:#A6ACCD;">      let reg = /\{\{(.*?)\}\}/g</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">      if (node.nodeType === 3 &amp;&amp; reg.test(textContent)) {</span></span>
<span class="line"><span style="color:#A6ACCD;">         const nodeTextContent = node.textContent</span></span>
<span class="line"><span style="color:#A6ACCD;">        const replaceText = () =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">            node.textContent = nodeTextContent.replace(reg, (matched, placeholder) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">                return placeholder.split(&#39;.&#39;).reduce((prev, key) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">                    return prev[key]</span></span>
<span class="line"><span style="color:#A6ACCD;">                }, data)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">            })</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        replaceText()</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">      // 如果还有子节点，继续递归 replace</span></span>
<span class="line"><span style="color:#A6ACCD;">      if (node.childNodes &amp;&amp; node.childNodes.length) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        replace(node)</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  replace(fragment)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  el.appendChild(fragment)</span></span>
<span class="line"><span style="color:#A6ACCD;">  return el</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>代码分析：我们使用 fragment 变量储存生成的真实 HTML 节点内容。通过 replace 方法对 进行数据替换，同时 的表达只会出现在 nodeType === 3 的文本类型节点中，因此对于符合 <code>node.nodeType === 3 &amp;&amp; reg.test(textContent)</code> 条件的情况，进行数据获取和填充。我们借助字符串 replace 方法第二个参数进行一次性替换，此时对于形如 的深层数据，通过 reduce 方法，获得正确的值。</p><p>因为 DOM 结构可能是多层的，所以对存在子节点的节点，依然使用递归进行 replace 替换。</p><p>这个编译过程比较简单，没有考虑到边界情况，只是单纯完成模版变量到真实 DOM 的转换，读者只需体会简单道理即可。</p><h4 id="双向绑定实现" tabindex="-1">双向绑定实现 <a class="header-anchor" href="#双向绑定实现" aria-hidden="true">#</a></h4><p>上述实现是单向的，数据变化引起了视图变化，那么如果页面中存在一个输入框，如何触发数据变化呢？比如：</p><p>我们需要在模版编译中，对于存在 v-model 属性的 node 进行事件监听，在输入框输入时，改变 v-model 属性值对应的数据即可（这里为 inputData），增加 compile 中的 replace 方法逻辑，对于 node.nodeType === 1 的 DOM 类型，伪代码如下：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">function replace(el, data) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  // 省略...</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (node.nodeType === 1) {</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    let attributesArray = node.attributes</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    Array.from(attributesArray).forEach(attr =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">      let attributeName = attr.name</span></span>
<span class="line"><span style="color:#A6ACCD;">      let attributeValue = attr.value</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">      if (name.includes(&#39;v-&#39;)) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        node.value = data[attributeValue]</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">      node.addEventListener(&#39;input&#39;, e =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">        let newVal = e.target.value</span></span>
<span class="line"><span style="color:#A6ACCD;">        data[attributeValue] = newVal</span></span>
<span class="line"><span style="color:#A6ACCD;">        // ...</span></span>
<span class="line"><span style="color:#A6ACCD;">        // 更改数据源，触发 setter</span></span>
<span class="line"><span style="color:#A6ACCD;">        // ...</span></span>
<span class="line"><span style="color:#A6ACCD;">      })</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  if (node.childNodes &amp;&amp; node.childNodes.length) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    replace(node)</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="发布订阅模式简单应用" tabindex="-1">发布订阅模式简单应用 <a class="header-anchor" href="#发布订阅模式简单应用" aria-hidden="true">#</a></h3><p>作为前端开发人员，我们对于所谓的“事件驱动”理念——即“事件发布订阅模式（Pub/Sub 模式）”一定再熟悉不过了。这种模式在 JavaScript 里面有与生俱来的基因：我们可以认为 JavaScript 本身就是事件驱动型语言，比如，应用中对一个 button 进行了事件绑定，用户点击之后就会触发按钮上面的 click 事件。这是因为此时有特定程序正在监听这个事件，随之触发了相关的处理程序。</p><p>这个模式的一个好处之一在于能够解耦，实现“高内聚、低耦合”的理念。这种模式对于我们框架的设计同样也不可或缺。请思考：通过前面内容的学习，我们了解了如何监听数据的变化。如果最终想实现响应式 MVVM，或所谓的双向绑定，那么还需要根据这个数据变化作出相应的视图更新。这个逻辑和我们在页面中对 button 绑定事件处理函数是多么相近。</p><p>那么这样一个“熟悉的”模式应该怎么实现呢，又该如何在框架中具体应用呢？看代码：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">class Notify {</span></span>
<span class="line"><span style="color:#A6ACCD;">  constructor() {</span></span>
<span class="line"><span style="color:#A6ACCD;">    this.subscribers = []</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  add(handler) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    this.subscribers.push(handler)</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  emit() {</span></span>
<span class="line"><span style="color:#A6ACCD;">    this.subscribers.forEach(subscriber =&gt; subscriber())</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>使用：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">let notify = new Notify()</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">notify.add(() =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">    console.log(&#39;emit here&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">notify.emit()</span></span>
<span class="line"><span style="color:#A6ACCD;">// emit here</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这就是一个简单实现的“事件发布订阅模式”，当然代码只是启发思路，真实应用还比较“粗糙”，没有进行事件名设置，APIs 也并不丰富，但完全能够说明问题了。其实读者翻看 Vue 源码，也能了解 Vue 中的发布订阅模式很简单。</p><h3 id="mvvm-融会贯通" tabindex="-1">MVVM 融会贯通 <a class="header-anchor" href="#mvvm-融会贯通" aria-hidden="true">#</a></h3><p>回顾一下前面的基本内容：数据拦截和代理、发布订阅模式、模版编译，那么如何根据这些概念实现一个 MVVM 框架呢？其实不管是 Vue 还是其他类库或框架，其解决思想都是建立在前文所述概念之上的。</p><p>我们来进行串联，整个过程是：首先对数据进行深度拦截或代理，对每一个属性的 getter 和 setter 进行“加工”，该“加工”具体做些什么后面马上会有说明。在模版初次编译时，解析指令（如 v-model），并进行依赖收集（），订阅数据的变化。</p><p>这里的依赖收集过程具体指：当调用 compiler 中的 replace 方法时，我们会读取数据进行模版变量的替换，这时候“读取数据时”需要做一个标记，用来表示“我依赖这一项数据”，因此我要订阅这个属性值的变化。Vue 中定义一个 Watcher 类来表示观察订阅依赖。这就实现了整套流程，换个思路再复述一遍：我们知道模版编译过程中会读取数据，进而触发数据源属性值的 getter，因此上面所说的数据代理的“加工”就是在数据监听的 getter 中记录这个依赖，同时在 setter 触发数据变化时，执行依赖对应的相关操作，最终触发模版中数据的变化。</p><p>我们抽象成流程图来理解：</p><p><img src="https://images.gitbook.cn/02926aa0-925b-11e9-a0f8-2d0a45937cae" alt="enter image description here"></p><p>这也是 Vue 框架（类库）的基本架构图。由此看出，Vue 的实现，或者大部分 MVVM 的实现，就是我们本节课程介绍的概念组合应用。</p><p>关于框架的对比剖析，更多话题我们留在《第 4-7 课：从框架和类库，我们该学到什么》一课中介绍。</p><h3 id="揭秘虚拟-dom" tabindex="-1">揭秘虚拟 DOM <a class="header-anchor" href="#揭秘虚拟-dom" aria-hidden="true">#</a></h3><p>我们来看现代框架中另一个重头戏——虚拟 DOM。虚拟 DOM 这个概念其实并没有那么新，甚至在前端三大框架问世之前，虚拟 DOM 就已经存在了，只不过 React 创造性的应用了虚拟 DOM，为前端发展带来了变革。Vue 2.0 也很快跟进，使得虚拟 DOM 彻底成为现代框架的重要基因。简单来说，虚拟 DOM 就是用数据结构表示 DOM 结构，它并没有真实 append 到 DOM 上，因此称之为“虚拟”。</p><p>应用虚拟 DOM 的收益也很直观：操作数据结构远比和浏览器交互去操作 DOM 快很多。请读者准确理解这句话：操作数据结构是指改变对象（虚拟 DOM），这个过程比修改真实 DOM 快很多。但虚拟 DOM 也最终是要挂载到浏览器上成为真实 DOM 节点，因此使用虚拟 DOM 并不能使得操作 DOM 的数量减少，但能够精确地获取最小的、最必要的操作 DOM 的集合。</p><p>这样一来，我们抽象表示 DOM，每次通过 DOM diff 计算出视图前后更新的最小差异，再去把最小差异应用到真实 DOM 上的做法，无疑更为可靠，性能更有保障。</p><p>那我们该如何表示虚拟 DOM 呢？又该如何产出虚拟 DOM 呢？</p><p>直观上我们看这样一段 DOM 结构：</p><ul><li>chapter1</li><li>chapter2</li><li>chapter3</li></ul><p>如果用 JavaScript 来表示，我们采用对象结构：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">const chapterListVirtualDom = {</span></span>
<span class="line"><span style="color:#A6ACCD;">  tagName: &#39;ul&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  attributes: {</span></span>
<span class="line"><span style="color:#A6ACCD;">    id: &#39;chapterList&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  },</span></span>
<span class="line"><span style="color:#A6ACCD;">  children: [</span></span>
<span class="line"><span style="color:#A6ACCD;">    { tagName: &#39;li&#39;, attributes: { class: &#39;chapter&#39; }, children: [&#39;chapter1&#39;] },</span></span>
<span class="line"><span style="color:#A6ACCD;">    { tagName: &#39;li&#39;, attributes: { class: &#39;chapter&#39; }, children: [&#39;chapter2&#39;] },</span></span>
<span class="line"><span style="color:#A6ACCD;">    { tagName: &#39;li&#39;, attributes: { class: &#39;chapter&#39; }, children: [&#39;chapter3&#39;] },</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>很好理解：tagName 表示虚拟 DOM 对应的真实 DOM 标签类型；attributes 是一个对象，表示真实 DOM 节点上所有的属性；children 对应真实 DOM 的 childNodes，其中 childNodes 每一项又是类似的结构。</p><p>我们来实现一个虚拟 DOM 生成类，用于生产虚拟 DOM：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">class Element {</span></span>
<span class="line"><span style="color:#A6ACCD;">  constructor(tagName, attributes = {}, children = []) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    this.tagName = tagName</span></span>
<span class="line"><span style="color:#A6ACCD;">    this.attributes = attributes</span></span>
<span class="line"><span style="color:#A6ACCD;">    this.children = children</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">function element(tagName, attributes, children) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  return new Element(tagName, attributes, children)</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>上述虚拟 DOM 就可以这样生成：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">const chapterListVirtualDom = element(&#39;ul&#39;, { id: &#39;list&#39; }, [</span></span>
<span class="line"><span style="color:#A6ACCD;">  element(&#39;li&#39;, { class: &#39;chapter&#39; }, [&#39;chapter1&#39;]),</span></span>
<span class="line"><span style="color:#A6ACCD;">  element(&#39;li&#39;, { class: &#39;chapter&#39; }, [&#39;chapter2&#39;]),</span></span>
<span class="line"><span style="color:#A6ACCD;">  element(&#39;li&#39;, { class: &#39;chapter&#39; }, [&#39;chapter3&#39;])</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如图：</p><p><img src="https://images.gitbook.cn/23d3e7c0-925b-11e9-a0f8-2d0a45937cae" alt="enter image description here"></p><p>是不是很简单？我们继续完成虚拟 DOM 向真实 DOM 节点的生成。首先实现一个 setAttribute 方法，后续的代码都将使用 setAttribute 方法来对 DOM 节点进行属性设置。</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">const setAttribute = (node, key, value) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  switch (key) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    case &#39;style&#39;:</span></span>
<span class="line"><span style="color:#A6ACCD;">      node.style.cssText = value</span></span>
<span class="line"><span style="color:#A6ACCD;">      break</span></span>
<span class="line"><span style="color:#A6ACCD;">    case &#39;value&#39;:</span></span>
<span class="line"><span style="color:#A6ACCD;">      let tagName = node.tagName || &#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">      tagName = tagName.toLowerCase()</span></span>
<span class="line"><span style="color:#A6ACCD;">      if (</span></span>
<span class="line"><span style="color:#A6ACCD;">        tagName === &#39;input&#39; || tagName === &#39;textarea&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">      ) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        node.value = value</span></span>
<span class="line"><span style="color:#A6ACCD;">      } else {</span></span>
<span class="line"><span style="color:#A6ACCD;">        // 如果节点不是 input 或者 textarea, 则使用 setAttribute 去设置属性</span></span>
<span class="line"><span style="color:#A6ACCD;">        node.setAttribute(key, value)</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">      break</span></span>
<span class="line"><span style="color:#A6ACCD;">    default:</span></span>
<span class="line"><span style="color:#A6ACCD;">      node.setAttribute(key, value)</span></span>
<span class="line"><span style="color:#A6ACCD;">      break</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>Element 类中加入 render 原型方法，该方法的目的是根据虚拟 DOM 生成真实 DOM 片段：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">class Element {</span></span>
<span class="line"><span style="color:#A6ACCD;">  constructor(tagName, attributes = {}, children = []) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    this.tagName = tagName</span></span>
<span class="line"><span style="color:#A6ACCD;">    this.attributes = attributes</span></span>
<span class="line"><span style="color:#A6ACCD;">    this.children = children</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  render () {</span></span>
<span class="line"><span style="color:#A6ACCD;">    let element = document.createElement(this.tagName)</span></span>
<span class="line"><span style="color:#A6ACCD;">    let attributes = this.attributes</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">     for (let key in attributes) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        setAttribute(element, key, attributes[key])</span></span>
<span class="line"><span style="color:#A6ACCD;">     }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    let children = this.children</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    children.forEach(child =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">      let childElement = child instanceof Element</span></span>
<span class="line"><span style="color:#A6ACCD;">        ? child.render() // 若 child 也是虚拟节点，递归进行</span></span>
<span class="line"><span style="color:#A6ACCD;">        : document.createTextNode(child)  // 若是字符串，直接创建文本节点</span></span>
<span class="line"><span style="color:#A6ACCD;">      element.appendChild(childElement)</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    return element</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">function element (tagName, attributes, children) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  return new Element(tagName, attributes, children)</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>实现也不困难，我们借助工具方法：setAttribute 进行属性的创建；对 children 每一项类型进行判断，如果是 Element 实例，进行递归调用 child 的 render 方法；直到遇见文本节点类型，进行内容渲染。</p><p>有了真实的 DOM 节点片段，我们趁热打铁，将真实的 DOM 节点渲染到浏览器上，实现 renderDOM 方法：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">const renderDom = (element, target) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  target.appendChild(element)</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>执行代码：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">const setAttribute = (node, key, value) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  switch (key) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    case &#39;style&#39;:</span></span>
<span class="line"><span style="color:#A6ACCD;">      node.style.cssText = value</span></span>
<span class="line"><span style="color:#A6ACCD;">      break</span></span>
<span class="line"><span style="color:#A6ACCD;">    case &#39;value&#39;:</span></span>
<span class="line"><span style="color:#A6ACCD;">      let tagName = node.tagName || &#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">      tagName = tagName.toLowerCase()</span></span>
<span class="line"><span style="color:#A6ACCD;">      if (</span></span>
<span class="line"><span style="color:#A6ACCD;">        tagName === &#39;input&#39; || tagName === &#39;textarea&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">      ) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        node.value = value</span></span>
<span class="line"><span style="color:#A6ACCD;">      } else {</span></span>
<span class="line"><span style="color:#A6ACCD;">        // 如果节点不是 input 或者 textarea，则使用 setAttribute 去设置属性</span></span>
<span class="line"><span style="color:#A6ACCD;">        node.setAttribute(key, value)</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">      break</span></span>
<span class="line"><span style="color:#A6ACCD;">    default:</span></span>
<span class="line"><span style="color:#A6ACCD;">      node.setAttribute(key, value)</span></span>
<span class="line"><span style="color:#A6ACCD;">      break</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">class Element {</span></span>
<span class="line"><span style="color:#A6ACCD;">  constructor(tagName, attributes = {}, children = []) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    this.tagName = tagName</span></span>
<span class="line"><span style="color:#A6ACCD;">    this.attributes = attributes</span></span>
<span class="line"><span style="color:#A6ACCD;">    this.children = children</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  render () {</span></span>
<span class="line"><span style="color:#A6ACCD;">    let element = document.createElement(this.tagName)</span></span>
<span class="line"><span style="color:#A6ACCD;">    let attributes = this.attributes</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">     for (let key in attributes) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        setAttribute(element, key, attributes[key])</span></span>
<span class="line"><span style="color:#A6ACCD;">     }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    let children = this.children</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    children.forEach(child =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">      let childElement = child instanceof Element</span></span>
<span class="line"><span style="color:#A6ACCD;">        ? child.render() // 若 child 也是虚拟节点，递归进行</span></span>
<span class="line"><span style="color:#A6ACCD;">        : document.createTextNode(child)  // 若是字符串，直接创建文本节点</span></span>
<span class="line"><span style="color:#A6ACCD;">      element.appendChild(childElement)</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    return element</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">function element (tagName, attributes, children) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  return new Element(tagName, attributes, children)</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const renderDom = (element, target) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  target.appendChild(element)</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const chapterListVirtualDom = element(&#39;ul&#39;, { id: &#39;list&#39; }, [</span></span>
<span class="line"><span style="color:#A6ACCD;">  element(&#39;li&#39;, { class: &#39;chapter&#39; }, [&#39;chapter1&#39;]),</span></span>
<span class="line"><span style="color:#A6ACCD;">  element(&#39;li&#39;, { class: &#39;chapter&#39; }, [&#39;chapter2&#39;]),</span></span>
<span class="line"><span style="color:#A6ACCD;">  element(&#39;li&#39;, { class: &#39;chapter&#39; }, [&#39;chapter3&#39;])</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const dom = chapterListVirtualDom.render()</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">renderDom(dom, document.body)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><p>得到如图：</p><p><img src="https://images.gitbook.cn/43b5d4e0-925b-11e9-a8e5-21b5567b38f4" alt="enter image description here"></p><h4 id="虚拟-dom-diff" tabindex="-1">虚拟 DOM diff <a class="header-anchor" href="#虚拟-dom-diff" aria-hidden="true">#</a></h4><p>有了上述基础，我们可以产出一份虚拟 DOM，并渲染在浏览器中。当用户在特定操作后，会产出新的一份虚拟 DOM，如何得出前后两份虚拟 DOM 的差异，并交给浏览器需要更新的结果呢？这就涉及到 DOM diff 的过程。</p><p>直观上，因为虚拟 DOM 是个树形结构，所以我们需要对两份虚拟 DOM 进行递归比较，将变化存储在一个变量 patches 中：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">const diff = (oldVirtualDom, newVirtualDom) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">    let patches = {}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    // 递归树，比较后的结果放到 patches</span></span>
<span class="line"><span style="color:#A6ACCD;">    walkToDiff(oldVirtualDom, newVirtualDom, 0, patches)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">     // 返回 diff 结果</span></span>
<span class="line"><span style="color:#A6ACCD;">    return patches</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>walkToDiff 前两个参数是两个需要比较的虚拟 DOM 对象；第三个参数记录 nodeIndex，在删除节点时使用，初始为 0；第四个参数是一个闭包变量，记录 diff 结果：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">let initialIndex = 0</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const walkToDiff = (oldVirtualDom, newVirtualDom, index, patches) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  let diffResult = []</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  // 如果 newVirtualDom 不存在，说明该节点被移除，我们将 type 为 REMOVE 的对象推进 diffResult 变量，并记录 index</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (!newVirtualDom) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    diffResult.push({</span></span>
<span class="line"><span style="color:#A6ACCD;">      type: &#39;REMOVE&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">      index</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  // 如果新旧节点都是文本节点，是字符串</span></span>
<span class="line"><span style="color:#A6ACCD;">  else if (typeof oldVirtualDom === &#39;string&#39; &amp;&amp; typeof newVirtualDom === &#39;string&#39;) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    // 比较文本是否相同，如果不同则记录新的结果</span></span>
<span class="line"><span style="color:#A6ACCD;">    if (oldVirtualDom !== newVirtualDom) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      diffResult.push({</span></span>
<span class="line"><span style="color:#A6ACCD;">        type: &#39;MODIFY_TEXT&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">        data: newVirtualDom,</span></span>
<span class="line"><span style="color:#A6ACCD;">        index</span></span>
<span class="line"><span style="color:#A6ACCD;">      })</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  // 如果新旧节点类型相同</span></span>
<span class="line"><span style="color:#A6ACCD;">  else if (oldVirtualDom.tagName === newVirtualDom.tagName) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    // 比较属性是否相同</span></span>
<span class="line"><span style="color:#A6ACCD;">    let diffAttributeResult = {}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    for (let key in oldVirtualDom) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      if (oldVirtualDom[key] !== newVirtualDom[key]) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        diffAttributeResult[key] = newVirtualDom[key]</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    for (let key in newVirtualDom) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      // 旧节点不存在的新属性</span></span>
<span class="line"><span style="color:#A6ACCD;">      if (!oldVirtualDom.hasOwnProperty(key)) {</span></span>
<span class="line"><span style="color:#A6ACCD;">          diffAttributeResult[key] = newVirtualDom[key]</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    if (Object.keys(diffAttributeResult).length &gt; 0) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        diffResult.push({</span></span>
<span class="line"><span style="color:#A6ACCD;">          type: &#39;MODIFY_ATTRIBUTES&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">          diffAttributeResult</span></span>
<span class="line"><span style="color:#A6ACCD;">        })</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    // 如果有子节点，遍历子节点</span></span>
<span class="line"><span style="color:#A6ACCD;">    oldVirtualDom.children.forEach((child, index) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">      walkToDiff(child, newVirtualDom.children[index], ++initialIndex, patches)</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  // else 说明节点类型不同，被直接替换了，我们直接将新的结果 push</span></span>
<span class="line"><span style="color:#A6ACCD;">  else {</span></span>
<span class="line"><span style="color:#A6ACCD;">    diffResult.push({</span></span>
<span class="line"><span style="color:#A6ACCD;">      type: &#39;REPLACE&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">      newVirtualDom</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  if (!oldVirtualDom) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    diffResult.push({</span></span>
<span class="line"><span style="color:#A6ACCD;">      type: &#39;REPLACE&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">      newVirtualDom</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  if (diffResult.length) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    patches[index] = diffResult</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><p>我们最后将所有代码放在一起：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">const setAttribute = (node, key, value) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  switch (key) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    case &#39;style&#39;:</span></span>
<span class="line"><span style="color:#A6ACCD;">      node.style.cssText = value</span></span>
<span class="line"><span style="color:#A6ACCD;">      break</span></span>
<span class="line"><span style="color:#A6ACCD;">    case &#39;value&#39;:</span></span>
<span class="line"><span style="color:#A6ACCD;">      let tagName = node.tagName || &#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">      tagName = tagName.toLowerCase()</span></span>
<span class="line"><span style="color:#A6ACCD;">      if (</span></span>
<span class="line"><span style="color:#A6ACCD;">        tagName === &#39;input&#39; || tagName === &#39;textarea&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">      ) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        node.value = value</span></span>
<span class="line"><span style="color:#A6ACCD;">      } else {</span></span>
<span class="line"><span style="color:#A6ACCD;">        // 如果节点不是 input 或者 textarea，则使用 setAttribute 去设置属性</span></span>
<span class="line"><span style="color:#A6ACCD;">        node.setAttribute(key, value)</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">      break</span></span>
<span class="line"><span style="color:#A6ACCD;">    default:</span></span>
<span class="line"><span style="color:#A6ACCD;">      node.setAttribute(key, value)</span></span>
<span class="line"><span style="color:#A6ACCD;">      break</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">class Element {</span></span>
<span class="line"><span style="color:#A6ACCD;">  constructor(tagName, attributes = {}, children = []) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    this.tagName = tagName</span></span>
<span class="line"><span style="color:#A6ACCD;">    this.attributes = attributes</span></span>
<span class="line"><span style="color:#A6ACCD;">    this.children = children</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  render () {</span></span>
<span class="line"><span style="color:#A6ACCD;">    let element = document.createElement(this.tagName)</span></span>
<span class="line"><span style="color:#A6ACCD;">    let attributes = this.attributes</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">     for (let key in attributes) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        setAttribute(element, key, attributes[key])</span></span>
<span class="line"><span style="color:#A6ACCD;">     }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    let children = this.children</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    children.forEach(child =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">      let childElement = child instanceof Element</span></span>
<span class="line"><span style="color:#A6ACCD;">        ? child.render() // 若 child 也是虚拟节点，递归进行</span></span>
<span class="line"><span style="color:#A6ACCD;">        : document.createTextNode(child)  // 若是字符串，直接创建文本节点</span></span>
<span class="line"><span style="color:#A6ACCD;">      element.appendChild(childElement)</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    return element</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">function element (tagName, attributes, children) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  return new Element(tagName, attributes, children)</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const renderDom = (element, target) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  target.appendChild(element)</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const diff = (oldVirtualDom, newVirtualDom) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  let patches = {}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  // 递归树 比较后的结果放到 patches</span></span>
<span class="line"><span style="color:#A6ACCD;">  walkToDiff(oldVirtualDom, newVirtualDom, 0, patches)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  return patches</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">let initialIndex = 0</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const walkToDiff = (oldVirtualDom, newVirtualDom, index, patches) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  let diffResult = []</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  // 如果 newVirtualDom 不存在，说明该节点被移除，我们将 type 为 REMOVE 的对象推进 diffResult 变量，并记录 index</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (!newVirtualDom) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    diffResult.push({</span></span>
<span class="line"><span style="color:#A6ACCD;">      type: &#39;REMOVE&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">      index</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  // 如果新旧节点都是文本节点，是字符串</span></span>
<span class="line"><span style="color:#A6ACCD;">  else if (typeof oldVirtualDom === &#39;string&#39; &amp;&amp; typeof newVirtualDom === &#39;string&#39;) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    // 比较文本是否相同，如果不同则记录新的结果</span></span>
<span class="line"><span style="color:#A6ACCD;">    if (oldVirtualDom !== newVirtualDom) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      diffResult.push({</span></span>
<span class="line"><span style="color:#A6ACCD;">        type: &#39;MODIFY_TEXT&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">        data: newVirtualDom,</span></span>
<span class="line"><span style="color:#A6ACCD;">        index</span></span>
<span class="line"><span style="color:#A6ACCD;">      })</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  // 如果新旧节点类型相同</span></span>
<span class="line"><span style="color:#A6ACCD;">  else if (oldVirtualDom.tagName === newVirtualDom.tagName) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    // 比较属性是否相同</span></span>
<span class="line"><span style="color:#A6ACCD;">    let diffAttributeResult = {}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    for (let key in oldVirtualDom) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      if (oldVirtualDom[key] !== newVirtualDom[key]) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        diffAttributeResult[key] = newVirtualDom[key]</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    for (let key in newVirtualDom) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      // 旧节点不存在的新属性</span></span>
<span class="line"><span style="color:#A6ACCD;">      if (!oldVirtualDom.hasOwnProperty(key)) {</span></span>
<span class="line"><span style="color:#A6ACCD;">          diffAttributeResult[key] = newVirtualDom[key]</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    if (Object.keys(diffAttributeResult).length &gt; 0) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        diffResult.push({</span></span>
<span class="line"><span style="color:#A6ACCD;">          type: &#39;MODIFY_ATTRIBUTES&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">          diffAttributeResult</span></span>
<span class="line"><span style="color:#A6ACCD;">        })</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    // 如果有子节点，遍历子节点</span></span>
<span class="line"><span style="color:#A6ACCD;">    oldVirtualDom.children.forEach((child, index) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">      walkToDiff(child, newVirtualDom.children[index], ++initialIndex, patches)</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  // else 说明节点类型不同，被直接替换了，我们直接将新的结果 push</span></span>
<span class="line"><span style="color:#A6ACCD;">  else {</span></span>
<span class="line"><span style="color:#A6ACCD;">    diffResult.push({</span></span>
<span class="line"><span style="color:#A6ACCD;">      type: &#39;REPLACE&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">      newVirtualDom</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  if (!oldVirtualDom) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    diffResult.push({</span></span>
<span class="line"><span style="color:#A6ACCD;">      type: &#39;REPLACE&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">      newVirtualDom</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  if (diffResult.length) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    patches[index] = diffResult</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br></div></div><p>我们对 diff 进行测试：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">const chapterListVirtualDom = element(&#39;ul&#39;, { id: &#39;list&#39; }, [</span></span>
<span class="line"><span style="color:#A6ACCD;">  element(&#39;li&#39;, { class: &#39;chapter&#39; }, [&#39;chapter1&#39;]),</span></span>
<span class="line"><span style="color:#A6ACCD;">  element(&#39;li&#39;, { class: &#39;chapter&#39; }, [&#39;chapter2&#39;]),</span></span>
<span class="line"><span style="color:#A6ACCD;">  element(&#39;li&#39;, { class: &#39;chapter&#39; }, [&#39;chapter3&#39;])</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const chapterListVirtualDom1 = element(&#39;ul&#39;, { id: &#39;list2&#39; }, [</span></span>
<span class="line"><span style="color:#A6ACCD;">  element(&#39;li&#39;, { class: &#39;chapter2&#39; }, [&#39;chapter4&#39;]),</span></span>
<span class="line"><span style="color:#A6ACCD;">  element(&#39;li&#39;, { class: &#39;chapter2&#39; }, [&#39;chapter5&#39;]),</span></span>
<span class="line"><span style="color:#A6ACCD;">  element(&#39;li&#39;, { class: &#39;chapter2&#39; }, [&#39;chapter6&#39;])</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">diff(chapterListVirtualDom, chapterListVirtualDom1)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>得到如图 diff 数组：</p><p><img src="https://images.gitbook.cn/6f1e0b70-925b-11e9-a0f8-2d0a45937cae" alt=""></p><h4 id="最小化差异应用" tabindex="-1">最小化差异应用 <a class="header-anchor" href="#最小化差异应用" aria-hidden="true">#</a></h4><p>大功告成之前，我们来看看都做了哪些事情：通过 Element class 生成了虚拟 DOM，通过 diff 方法对任意两个虚拟 DOM 进行比对，得到差异。那么这个差异如何更新到现有的 DOM 节点中呢？看上去需要一个 patch 方法来完成：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">const patch = (node, patches) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  let walker = { index: 0 }</span></span>
<span class="line"><span style="color:#A6ACCD;">  walk(node, walker, patches)</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>patch 方法接受一个真实的 DOM 节点，它是现有的浏览器中需要进行更新的 DOM 节点，同时接受一个最小化差异集合，该集合对接 diff 方法返回的结果。在 patch 方法内部，我们调用了 walk 函数：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">const walk = (node, walker, patches) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  let currentPatch = patches[walker.index]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  let childNodes = node.childNodes</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  childNodes.forEach(child =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">    walker.index++</span></span>
<span class="line"><span style="color:#A6ACCD;">    walk(child, walker, patches)</span></span>
<span class="line"><span style="color:#A6ACCD;">  })</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  if (currentPatch) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    doPatch(node, currentPatch)</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>walk 进行自身递归，对于当前节点的差异调用 doPatch 方法进行更新：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">const doPatch = (node, patches) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  patches.forEach(patch =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">    switch (patch.type) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      case &#39;MODIFY_ATTRIBUTES&#39;:</span></span>
<span class="line"><span style="color:#A6ACCD;">        const attributes = patch.diffAttributeResult.attributes</span></span>
<span class="line"><span style="color:#A6ACCD;">        for (let key in attributes) {</span></span>
<span class="line"><span style="color:#A6ACCD;">            if (node.nodeType !== 1) return</span></span>
<span class="line"><span style="color:#A6ACCD;">            const value = attributes[key]</span></span>
<span class="line"><span style="color:#A6ACCD;">            if (value) {</span></span>
<span class="line"><span style="color:#A6ACCD;">              setAttribute(node, key, value)</span></span>
<span class="line"><span style="color:#A6ACCD;">            } else {</span></span>
<span class="line"><span style="color:#A6ACCD;">              node.removeAttribute(key)</span></span>
<span class="line"><span style="color:#A6ACCD;">            }</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">        break</span></span>
<span class="line"><span style="color:#A6ACCD;">      case &#39;MODIFY_TEXT&#39;:</span></span>
<span class="line"><span style="color:#A6ACCD;">        node.textContent = patch.data</span></span>
<span class="line"><span style="color:#A6ACCD;">        break</span></span>
<span class="line"><span style="color:#A6ACCD;">      case &#39;REPLACE&#39;:</span></span>
<span class="line"><span style="color:#A6ACCD;">        let newNode = (patch.newNode instanceof Element) ? render(patch.newNode) : document.createTextNode(patch.newNode)</span></span>
<span class="line"><span style="color:#A6ACCD;">        node.parentNode.replaceChild(newNode, node)</span></span>
<span class="line"><span style="color:#A6ACCD;">        break</span></span>
<span class="line"><span style="color:#A6ACCD;">      case &#39;REMOVE&#39;:</span></span>
<span class="line"><span style="color:#A6ACCD;">        node.parentNode.removeChild(node)</span></span>
<span class="line"><span style="color:#A6ACCD;">        break</span></span>
<span class="line"><span style="color:#A6ACCD;">      default:</span></span>
<span class="line"><span style="color:#A6ACCD;">        break</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  })</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>doPatch 对四种类型的 diff 进行处理，最终进行测试：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">var element = chapterListVirtualDom.render()</span></span>
<span class="line"><span style="color:#A6ACCD;">renderDom(element, document.body)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const patches = diff(chapterListVirtualDom, chapterListVirtualDom1)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">patch(element, patches)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>全部代码放在一起：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">const setAttribute = (node, key, value) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  switch (key) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    case &#39;style&#39;:</span></span>
<span class="line"><span style="color:#A6ACCD;">      node.style.cssText = value</span></span>
<span class="line"><span style="color:#A6ACCD;">      break</span></span>
<span class="line"><span style="color:#A6ACCD;">    case &#39;value&#39;:</span></span>
<span class="line"><span style="color:#A6ACCD;">      let tagName = node.tagName || &#39;&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">      tagName = tagName.toLowerCase()</span></span>
<span class="line"><span style="color:#A6ACCD;">      if (</span></span>
<span class="line"><span style="color:#A6ACCD;">        tagName === &#39;input&#39; || tagName === &#39;textarea&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">      ) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        node.value = value</span></span>
<span class="line"><span style="color:#A6ACCD;">      } else {</span></span>
<span class="line"><span style="color:#A6ACCD;">        // 如果节点不是 input 或者 textarea, 则使用 setAttribute 去设置属性</span></span>
<span class="line"><span style="color:#A6ACCD;">        node.setAttribute(key, value)</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">      break</span></span>
<span class="line"><span style="color:#A6ACCD;">    default:</span></span>
<span class="line"><span style="color:#A6ACCD;">      node.setAttribute(key, value)</span></span>
<span class="line"><span style="color:#A6ACCD;">      break</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">class Element {</span></span>
<span class="line"><span style="color:#A6ACCD;">  constructor(tagName, attributes = {}, children = []) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    this.tagName = tagName</span></span>
<span class="line"><span style="color:#A6ACCD;">    this.attributes = attributes</span></span>
<span class="line"><span style="color:#A6ACCD;">    this.children = children</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  render () {</span></span>
<span class="line"><span style="color:#A6ACCD;">    let element = document.createElement(this.tagName)</span></span>
<span class="line"><span style="color:#A6ACCD;">    let attributes = this.attributes</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">     for (let key in attributes) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        setAttribute(element, key, attributes[key])</span></span>
<span class="line"><span style="color:#A6ACCD;">     }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    let children = this.children</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    children.forEach(child =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">      let childElement = child instanceof Element</span></span>
<span class="line"><span style="color:#A6ACCD;">        ? child.render() // 若 child 也是虚拟节点，递归进行</span></span>
<span class="line"><span style="color:#A6ACCD;">        : document.createTextNode(child)  // 若是字符串，直接创建文本节点</span></span>
<span class="line"><span style="color:#A6ACCD;">      element.appendChild(childElement)</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    return element</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">function element (tagName, attributes, children) {</span></span>
<span class="line"><span style="color:#A6ACCD;">  return new Element(tagName, attributes, children)</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const renderDom = (element, target) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  target.appendChild(element)</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const diff = (oldVirtualDom, newVirtualDom) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  let patches = {}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  // 递归树 比较后的结果放到 patches</span></span>
<span class="line"><span style="color:#A6ACCD;">  walkToDiff(oldVirtualDom, newVirtualDom, 0, patches)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  return patches</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">let initialIndex = 0</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const walkToDiff = (oldVirtualDom, newVirtualDom, index, patches) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  let diffResult = []</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  // 如果 newVirtualDom 不存在，说明该节点被移除，我们将 type 为 REMOVE 的对象推进 diffResult 变量，并记录 index</span></span>
<span class="line"><span style="color:#A6ACCD;">  if (!newVirtualDom) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    diffResult.push({</span></span>
<span class="line"><span style="color:#A6ACCD;">      type: &#39;REMOVE&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">      index</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  // 如果新旧节点都是文本节点，是字符串</span></span>
<span class="line"><span style="color:#A6ACCD;">  else if (typeof oldVirtualDom === &#39;string&#39; &amp;&amp; typeof newVirtualDom === &#39;string&#39;) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    // 比较文本是否相同，如果不同则记录新的结果</span></span>
<span class="line"><span style="color:#A6ACCD;">    if (oldVirtualDom !== newVirtualDom) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      diffResult.push({</span></span>
<span class="line"><span style="color:#A6ACCD;">        type: &#39;MODIFY_TEXT&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">        data: newVirtualDom,</span></span>
<span class="line"><span style="color:#A6ACCD;">        index</span></span>
<span class="line"><span style="color:#A6ACCD;">      })</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  // 如果新旧节点类型相同</span></span>
<span class="line"><span style="color:#A6ACCD;">  else if (oldVirtualDom.tagName === newVirtualDom.tagName) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    // 比较属性是否相同</span></span>
<span class="line"><span style="color:#A6ACCD;">    let diffAttributeResult = {}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    for (let key in oldVirtualDom) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      if (oldVirtualDom[key] !== newVirtualDom[key]) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        diffAttributeResult[key] = newVirtualDom[key]</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    for (let key in newVirtualDom) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      // 旧节点不存在的新属性</span></span>
<span class="line"><span style="color:#A6ACCD;">      if (!oldVirtualDom.hasOwnProperty(key)) {</span></span>
<span class="line"><span style="color:#A6ACCD;">          diffAttributeResult[key] = newVirtualDom[key]</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    if (Object.keys(diffAttributeResult).length &gt; 0) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        diffResult.push({</span></span>
<span class="line"><span style="color:#A6ACCD;">          type: &#39;MODIFY_ATTRIBUTES&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">          diffAttributeResult</span></span>
<span class="line"><span style="color:#A6ACCD;">        })</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    // 如果有子节点，遍历子节点</span></span>
<span class="line"><span style="color:#A6ACCD;">    oldVirtualDom.children.forEach((child, index) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">      walkToDiff(child, newVirtualDom.children[index], ++initialIndex, patches)</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">  // else 说明节点类型不同，被直接替换了，我们直接将新的结果 push</span></span>
<span class="line"><span style="color:#A6ACCD;">  else {</span></span>
<span class="line"><span style="color:#A6ACCD;">    diffResult.push({</span></span>
<span class="line"><span style="color:#A6ACCD;">      type: &#39;REPLACE&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">      newVirtualDom</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  if (!oldVirtualDom) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    diffResult.push({</span></span>
<span class="line"><span style="color:#A6ACCD;">      type: &#39;REPLACE&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">      newVirtualDom</span></span>
<span class="line"><span style="color:#A6ACCD;">    })</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  if (diffResult.length) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    patches[index] = diffResult</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const chapterListVirtualDom = element(&#39;ul&#39;, { id: &#39;list&#39; }, [</span></span>
<span class="line"><span style="color:#A6ACCD;">  element(&#39;li&#39;, { class: &#39;chapter&#39; }, [&#39;chapter1&#39;]),</span></span>
<span class="line"><span style="color:#A6ACCD;">  element(&#39;li&#39;, { class: &#39;chapter&#39; }, [&#39;chapter2&#39;]),</span></span>
<span class="line"><span style="color:#A6ACCD;">  element(&#39;li&#39;, { class: &#39;chapter&#39; }, [&#39;chapter3&#39;])</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const chapterListVirtualDom1 = element(&#39;ul&#39;, { id: &#39;list2&#39; }, [</span></span>
<span class="line"><span style="color:#A6ACCD;">  element(&#39;li&#39;, { class: &#39;chapter2&#39; }, [&#39;chapter4&#39;]),</span></span>
<span class="line"><span style="color:#A6ACCD;">  element(&#39;li&#39;, { class: &#39;chapter2&#39; }, [&#39;chapter5&#39;]),</span></span>
<span class="line"><span style="color:#A6ACCD;">  element(&#39;li&#39;, { class: &#39;chapter2&#39; }, [&#39;chapter6&#39;])</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const patch = (node, patches) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  let walker = { index: 0 }</span></span>
<span class="line"><span style="color:#A6ACCD;">  walk(node, walker, patches)</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const walk = (node, walker, patches) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  let currentPatch = patches[walker.index]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  let childNodes = node.childNodes</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  childNodes.forEach(child =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">    walker.index++</span></span>
<span class="line"><span style="color:#A6ACCD;">    walk(child, walker, patches)</span></span>
<span class="line"><span style="color:#A6ACCD;">  })</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">  if (currentPatch) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    doPatch(node, currentPatch)</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">const doPatch = (node, patches) =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">  patches.forEach(patch =&gt; {</span></span>
<span class="line"><span style="color:#A6ACCD;">    switch (patch.type) {</span></span>
<span class="line"><span style="color:#A6ACCD;">      case &#39;MODIFY_ATTRIBUTES&#39;:</span></span>
<span class="line"><span style="color:#A6ACCD;">        const attributes = patch.diffAttributeResult.attributes</span></span>
<span class="line"><span style="color:#A6ACCD;">        for (let key in attributes) {</span></span>
<span class="line"><span style="color:#A6ACCD;">            if (node.nodeType !== 1) return</span></span>
<span class="line"><span style="color:#A6ACCD;">            const value = attributes[key]</span></span>
<span class="line"><span style="color:#A6ACCD;">            if (value) {</span></span>
<span class="line"><span style="color:#A6ACCD;">              setAttribute(node, key, value)</span></span>
<span class="line"><span style="color:#A6ACCD;">            } else {</span></span>
<span class="line"><span style="color:#A6ACCD;">              node.removeAttribute(key)</span></span>
<span class="line"><span style="color:#A6ACCD;">            }</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">        break</span></span>
<span class="line"><span style="color:#A6ACCD;">      case &#39;MODIFY_TEXT&#39;:</span></span>
<span class="line"><span style="color:#A6ACCD;">        node.textContent = patch.data</span></span>
<span class="line"><span style="color:#A6ACCD;">        break</span></span>
<span class="line"><span style="color:#A6ACCD;">      case &#39;REPLACE&#39;:</span></span>
<span class="line"><span style="color:#A6ACCD;">        let newNode = (patch.newNode instanceof Element) ? render(patch.newNode) : document.createTextNode(patch.newNode)</span></span>
<span class="line"><span style="color:#A6ACCD;">        node.parentNode.replaceChild(newNode, node)</span></span>
<span class="line"><span style="color:#A6ACCD;">        break</span></span>
<span class="line"><span style="color:#A6ACCD;">      case &#39;REMOVE&#39;:</span></span>
<span class="line"><span style="color:#A6ACCD;">        node.parentNode.removeChild(node)</span></span>
<span class="line"><span style="color:#A6ACCD;">        break</span></span>
<span class="line"><span style="color:#A6ACCD;">      default:</span></span>
<span class="line"><span style="color:#A6ACCD;">        break</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  })</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br></div></div><p>先执行：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">var element = chapterListVirtualDom.render()</span></span>
<span class="line"><span style="color:#A6ACCD;">renderDom(element, document.body)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>再执行：</p><div class="language-text line-numbers-mode"><button class="copy"></button><span class="lang">text</span><pre><code><span class="line"><span style="color:#A6ACCD;">const patches = diff(chapterListVirtualDom, chapterListVirtualDom1)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">patch(element, patches)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>生成结果符合预期。</p><p>短短不到两百行代码，就实现了虚拟 DOM 思想的全部流程。当然其中还有一些优化手段，一些边界情况并没有进行特别处理，但是我们去翻看一些著名的虚拟 DOM 库：snabbdom、etch 等，其实现思想和上述教例完全一致。</p><h3 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-hidden="true">#</a></h3><p>现代框架无疑极大程度上解放了前端生产力，其设计思想相互借鉴，存在非常多的共性。本讲我们通过分析前端框架中的共性，梳理概念原理，希望达到“任何一种框架变得不再神秘”的目的。掌握了这些基本思想，我们不仅能触类旁通，更快地上手框架，更能学习进阶，吸取优秀框架的精华。</p><h3 id="分享交流" tabindex="-1">分享交流 <a class="header-anchor" href="#分享交流" aria-hidden="true">#</a></h3><p>阅读文章过程中有任何疑问可随时跟其他小伙伴讨论，或者直接向作者 LucasHC 提问（作者看到后抽空回复）。 <strong>你的分享不仅帮助他人，更会提升自己。</strong></p><p>你也可以说说自己最想了解的主题，课程内容会根据部分读者的意见和建议迭代和完善。</p><p>此外，我们为本课程付费读者创建了《前端开发核心知识进阶》微信交流群，以方便更有针对性地讨论课程相关问题（入群请到第 1-2 课末尾添加 GitChat 小助手伽利略的微信，并注明「前端核心」，谢谢~）</p></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-f0af2311 data-v-a54a85bd><div class="edit-info" data-v-a54a85bd><!----><div class="last-updated" data-v-a54a85bd><p class="VPLastUpdated" data-v-a54a85bd data-v-f7d51a9c>最后更新时间: <time datatime="2023-02-14T14:03:20.000Z" data-v-f7d51a9c></time></p></div></div><div class="prev-next" data-v-a54a85bd><div class="pager" data-v-a54a85bd><a class="pager-link prev" href="/vitepress-demo/advanced-core-knowledage-front-end/bu-ke-hu-shi-de-html-he-css/015-xiang-ying-shi-bu-ju-he-bootstrap-de-shi-xian-fen-xi.html" data-v-a54a85bd><span class="desc" data-v-a54a85bd>Previous page</span><span class="title" data-v-a54a85bd>响应式布局和 Bootstrap 的实现分析</span></a></div><div class="has-prev pager" data-v-a54a85bd><a class="pager-link next" href="/vitepress-demo/advanced-core-knowledage-front-end/qian-duan-kuang-jia/017-ni-zhen-de-dong-react-ma.html" data-v-a54a85bd><span class="desc" data-v-a54a85bd>Next page</span><span class="title" data-v-a54a85bd>你真的懂 React 吗</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><footer class="VPFooter has-sidebar" data-v-ca9ccb7e data-v-9f24cc86><div class="container" data-v-9f24cc86><p class="message" data-v-9f24cc86>Released under the MIT License.</p><p class="copyright" data-v-9f24cc86>Copyright © 2022-09-tiger</p></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"advanced-core-knowledage-front-end_0-ru-he-tu-po-qian-duan-kai-fa-ji-shu-ping-jing.md\":\"80a190f2\",\"advanced-core-knowledage-front-end_050-da-hua-she-qu-he-yi-ming-ji-shu-zhe-de-zi-wo-xiu-yang.md\":\"8fcbad74\",\"advanced-core-knowledage-front-end_bian-cheng-si-wei-he-suan-fa_037-jie-mi-qian-duan-she-ji-mo-shi-shang.md\":\"484ca648\",\"advanced-core-knowledage-front-end_bian-cheng-si-wei-he-suan-fa_038-jie-mi-qian-duan-she-ji-mo-shi-xia.md\":\"9b208063\",\"advanced-core-knowledage-front-end_bian-cheng-si-wei-he-suan-fa_039-pou-xi-wu-chu-bu-zai-de-shu-ju-jie-gou.md\":\"c198da9b\",\"advanced-core-knowledage-front-end_bian-cheng-si-wei-he-suan-fa_040-gu-lao-you-xin-chao-de-han-shu-shi.md\":\"a6d9529b\",\"advanced-core-knowledage-front-end_bian-cheng-si-wei-he-suan-fa_041-na-xie-nian-chang-kao-de-qian-duan-suan-fa-shang.md\":\"b7d84b23\",\"advanced-core-knowledage-front-end_bian-cheng-si-wei-he-suan-fa_042-na-xie-nian-chang-kao-de-qian-duan-suan-fa-zhong.md\":\"022ebcfa\",\"advanced-core-knowledage-front-end_bian-cheng-si-wei-he-suan-fa_043-na-xie-nian-chang-kao-de-qian-duan-suan-fa-xia.md\":\"bbe22e44\",\"advanced-core-knowledage-front-end_bian-cheng-si-wei-he-suan-fa_044-fen-xi-yi-dao-wei-xin-mian-shi-ti.md\":\"682af7d9\",\"advanced-core-knowledage-front-end_bian-cheng-si-wei-he-suan-fa_readme.md\":\"d0215821\",\"advanced-core-knowledage-front-end_bu-ke-hu-shi-de-html-he-css_013-qian-duan-mian-shi-li-bu-kai-de-mian-zi-gong-cheng.md\":\"24e0386e\",\"advanced-core-knowledage-front-end_bu-ke-hu-shi-de-html-he-css_014-jin-ji-de-css-he-html.md\":\"2f727fdf\",\"advanced-core-knowledage-front-end_bu-ke-hu-shi-de-html-he-css_015-xiang-ying-shi-bu-ju-he-bootstrap-de-shi-xian-fen-xi.md\":\"83adf8f8\",\"advanced-core-knowledage-front-end_bu-ke-hu-shi-de-html-he-css_readme.md\":\"25e8bda6\",\"advanced-core-knowledage-front-end_index.md\":\"1bc1d094\",\"advanced-core-knowledage-front-end_javascript-ji-chu-qiang-hua_001-yi-wang-da-jin-this-dui-zhi-hang-shang-xia-wen-shuo-yes.md\":\"cf157d90\",\"advanced-core-knowledage-front-end_javascript-ji-chu-qiang-hua_002-lao-si-ji-ye-hui-zai-bi-bao-xiang-guan-zhi-shi-dian-fan-che-shang.md\":\"bf435c3a\",\"advanced-core-knowledage-front-end_javascript-ji-chu-qiang-hua_003-lao-si-ji-ye-hui-zai-bi-bao-xiang-guan-zhi-shi-dian-fan-che-xia.md\":\"c8635aeb\",\"advanced-core-knowledage-front-end_javascript-ji-chu-qiang-hua_004-wo-men-bu-bei-song-api-zhi-shi-xian-api.md\":\"15625cde\",\"advanced-core-knowledage-front-end_javascript-ji-chu-qiang-hua_005javascript-zhi-shi-tu-pu-he-gao-pin-kao-dian-shu-li.md\":\"df5975c0\",\"advanced-core-knowledage-front-end_javascript-ji-chu-qiang-hua_006-qi-ta-ji-chu-ti-ku.md\":\"1110aa32\",\"advanced-core-knowledage-front-end_javascript-ji-chu-qiang-hua_readme.md\":\"72074067\",\"advanced-core-knowledage-front-end_javascript-yu-yan-jin-jie_007-yi-bu-bu-ke-pa-si-ji-ying-bei-shi-jian-na-xia-shang.md\":\"9792def4\",\"advanced-core-knowledage-front-end_javascript-yu-yan-jin-jie_008-yi-bu-bu-ke-pa-si-ji-ying-bei-shi-jian-na-xia-xia.md\":\"12b76215\",\"advanced-core-knowledage-front-end_javascript-yu-yan-jin-jie_009-ni-yi-wei-wo-zhen-de-xiang-rang-ni-shou-xie-promise-ma-shang.md\":\"183a6d1f\",\"advanced-core-knowledage-front-end_javascript-yu-yan-jin-jie_010-ni-yi-wei-wo-zhen-de-xiang-rang-ni-shou-xie-promise-ma-xia.md\":\"1021a996\",\"advanced-core-knowledage-front-end_javascript-yu-yan-jin-jie_011-mian-xiang-dui-xiang-he-yuan-xing-yong-bu-guo-shi-de-hua-ti.md\":\"fb8c196d\",\"advanced-core-knowledage-front-end_javascript-yu-yan-jin-jie_012-jiu-jing-gai-ru-he-xue-xi-yu-shi-ju-jin-de-es.md\":\"af2f88aa\",\"advanced-core-knowledage-front-end_javascript-yu-yan-jin-jie_readme.md\":\"c4e0f8b2\",\"advanced-core-knowledage-front-end_qian-duan-gong-cheng-hua_023-shen-ru-qian-chu-mo-kuai-hua-han-treeshaking-shang.md\":\"d8460f89\",\"advanced-core-knowledage-front-end_qian-duan-gong-cheng-hua_024-shen-ru-qian-chu-mo-kuai-hua-han-treeshaking-xia.md\":\"b77cae67\",\"advanced-core-knowledage-front-end_qian-duan-gong-cheng-hua_025webpack-gong-cheng-shi-he-qian-duan-gong-cheng-shi-shang.md\":\"8ca7949c\",\"advanced-core-knowledage-front-end_qian-duan-gong-cheng-hua_026webpack-gong-cheng-shi-he-qian-duan-gong-cheng-shi-xia.md\":\"0fef5e8e\",\"advanced-core-knowledage-front-end_qian-duan-gong-cheng-hua_027-qian-duan-gong-cheng-hua-bei-hou-de-xiang-mu-zu-zhi-she-ji-shang.md\":\"a91e86ea\",\"advanced-core-knowledage-front-end_qian-duan-gong-cheng-hua_028-qian-duan-gong-cheng-hua-bei-hou-de-xiang-mu-zu-zhi-she-ji-xia.md\":\"e12d8b6f\",\"advanced-core-knowledage-front-end_qian-duan-gong-cheng-hua_029-dai-ma-gui-fan-gong-ju-ji-bei-hou-ji-shu-she-ji-shang.md\":\"3b05ea92\",\"advanced-core-knowledage-front-end_qian-duan-gong-cheng-hua_030-dai-ma-gui-fan-gong-ju-ji-bei-hou-ji-shu-she-ji-xia.md\":\"2aa27d25\",\"advanced-core-knowledage-front-end_qian-duan-gong-cheng-hua_readme.md\":\"58c42581\",\"advanced-core-knowledage-front-end_qian-duan-kuang-jia_016-chu-lei-pang-tong-duo-zhong-kuang-jia.md\":\"461e9a05\",\"advanced-core-knowledage-front-end_qian-duan-kuang-jia_017-ni-zhen-de-dong-react-ma.md\":\"3bb62461\",\"advanced-core-knowledage-front-end_qian-duan-kuang-jia_018-jie-mi-react-zhen-di-zu-jian-she-ji.md\":\"3d1d4ae3\",\"advanced-core-knowledage-front-end_qian-duan-kuang-jia_019-jie-mi-react-zhen-di-shu-ju-zhuang-tai-guan-li.md\":\"9072037e\",\"advanced-core-knowledage-front-end_qian-duan-kuang-jia_020react-de-xian-zhuang-yu-wei-lai.md\":\"a82f9288\",\"advanced-core-knowledage-front-end_qian-duan-kuang-jia_021-tong-gou-ying-yong-zhong-ni-suo-hu-lve-de-xi-jie.md\":\"32648693\",\"advanced-core-knowledage-front-end_qian-duan-kuang-jia_022-cong-kuang-jia-he-lei-ku-wo-men-gai-xue-dao-shi-mo.md\":\"c7fce268\",\"advanced-core-knowledage-front-end_qian-duan-kuang-jia_readme.md\":\"e5382bd6\",\"advanced-core-knowledage-front-end_wang-luo-zhi-shi_045-li-bu-kai-de-wang-luo-ji-chu.md\":\"1654fd81\",\"advanced-core-knowledage-front-end_wang-luo-zhi-shi_046-huan-cun-shui-du-dong-yi-wen-du-ya-ba-shang.md\":\"8296199a\",\"advanced-core-knowledage-front-end_wang-luo-zhi-shi_047-huan-cun-shui-du-dong-yi-wen-du-ya-ba-xia.md\":\"6b85e2ad\",\"advanced-core-knowledage-front-end_wang-luo-zhi-shi_048http-de-shen-si-wo-cong-he-er-lai-qu-xiang-he-chu.md\":\"5aa71c77\",\"advanced-core-knowledage-front-end_wang-luo-zhi-shi_049-bu-ke-hu-shi-de-qian-duan-an-quan-dan-ye-ying-yong-jian-quan-she-ji.md\":\"6bde5d16\",\"advanced-core-knowledage-front-end_wang-luo-zhi-shi_readme.md\":\"6d408ca6\",\"advanced-core-knowledage-front-end_xing-neng-you-hua_031-xing-neng-jian-kong-he-cuo-wu-shou-ji-yu-shang-bao-shang.md\":\"9b39cae2\",\"advanced-core-knowledage-front-end_xing-neng-you-hua_032-xing-neng-jian-kong-he-cuo-wu-shou-ji-yu-shang-bao-xia.md\":\"4785148b\",\"advanced-core-knowledage-front-end_xing-neng-you-hua_033-xing-neng-you-hua-wen-ti-lao-si-ji-ru-he-jie-jue-shang.md\":\"141a0e56\",\"advanced-core-knowledage-front-end_xing-neng-you-hua_034-xing-neng-you-hua-wen-ti-lao-si-ji-ru-he-jie-jue-xia.md\":\"a3f7c4bc\",\"advanced-core-knowledage-front-end_xing-neng-you-hua_035-yi-react-wei-li-shuo-shuo-kuang-jia-he-xing-neng-shang.md\":\"1bb2f283\",\"advanced-core-knowledage-front-end_xing-neng-you-hua_036-yi-react-wei-li-shuo-shuo-kuang-jia-he-xing-neng-xia.md\":\"50f15ea8\",\"advanced-core-knowledage-front-end_xing-neng-you-hua_readme.md\":\"3306b629\",\"front-spec_eslint_index.md\":\"0ecfafd5\",\"front-spec_git_index.md\":\"3e7ac1f2\",\"front-spec_index.md\":\"722786e3\",\"front-spec_project_index.md\":\"cc659b48\",\"front-spec_recommend_index.md\":\"2a4ca301\",\"front-spec_tip_index.md\":\"83d6d466\",\"front-spec_vue_index.md\":\"8d9ea9b2\",\"http-protocol_01_01.md\":\"c2a09fb9\",\"http-protocol_02_01.md\":\"6ff6aed7\",\"http-protocol_02_02.md\":\"f49fd73b\",\"http-protocol_02_03.md\":\"ab3d5b7a\",\"http-protocol_02_04.md\":\"b7f6570b\",\"http-protocol_02_05.md\":\"2550e7db\",\"http-protocol_02_06.md\":\"e2478638\",\"http-protocol_02_07.md\":\"7680a5e4\",\"http-protocol_02_index.md\":\"1507515c\",\"http-protocol_03_01.md\":\"c4c054a3\",\"http-protocol_03_02.md\":\"de49dfbe\",\"http-protocol_03_03.md\":\"494c9237\",\"http-protocol_03_04.md\":\"8edf9ddf\",\"http-protocol_03_05.md\":\"b2006f26\",\"http-protocol_03_06.md\":\"4c31fbcb\",\"http-protocol_03_07.md\":\"f8fa170a\",\"http-protocol_03_index.md\":\"5ab8a95f\",\"http-protocol_04_01.md\":\"050fd932\",\"http-protocol_04_02.md\":\"18adc47b\",\"http-protocol_04_03.md\":\"b26af46b\",\"http-protocol_04_04.md\":\"b2b405c4\",\"http-protocol_04_05.md\":\"9fa72b05\",\"http-protocol_04_06.md\":\"1742f2bc\",\"http-protocol_04_07.md\":\"e924ca98\",\"http-protocol_04_08.md\":\"bb06a0fd\",\"http-protocol_04_index.md\":\"4c56f610\",\"http-protocol_05_01.md\":\"c900f808\",\"http-protocol_05_02.md\":\"776d4fc8\",\"http-protocol_05_03.md\":\"02cb2503\",\"http-protocol_05_04.md\":\"0aaaf770\",\"http-protocol_05_05.md\":\"30d448c7\",\"http-protocol_05_06.md\":\"dddcbecd\",\"http-protocol_05_07.md\":\"fcb5189c\",\"http-protocol_05_index.md\":\"34a28dd5\",\"http-protocol_06_01.md\":\"bca4a22a\",\"http-protocol_06_02.md\":\"446b0796\",\"http-protocol_06_03.md\":\"9df3b96e\",\"http-protocol_06_04.md\":\"7f47400a\",\"http-protocol_06_index.md\":\"edf1bf52\",\"http-protocol_07_01.md\":\"11a5f616\",\"http-protocol_07_02.md\":\"a4798b4c\",\"http-protocol_07_03.md\":\"5a140290\",\"http-protocol_07_04.md\":\"802e3491\",\"http-protocol_07_05.md\":\"81c854b5\",\"http-protocol_07_index.md\":\"0dba52b9\",\"http-protocol_08_index.md\":\"e7d84997\",\"http-protocol_09.md\":\"e30e17ab\",\"http-protocol_index.md\":\"885fb3cd\",\"index.md\":\"4de75481\",\"javascript-design-model_mvc-mvp-mvvm.md\":\"2735429d\",\"javascript-design-model_abstract-factory-model.md\":\"1bc2ec6c\",\"javascript-design-model_adapter-mode.md\":\"9d553c8c\",\"javascript-design-model_bridge-mode.md\":\"18e28094\",\"javascript-design-model_builder-mode.md\":\"d84d3151\",\"javascript-design-model_chain-mode.md\":\"79c6ebaf\",\"javascript-design-model_chain-of-responsibility-mode.md\":\"235a3fa9\",\"javascript-design-model_closures-and-higher-order-functions.md\":\"f52865db\",\"javascript-design-model_combination-mode.md\":\"0881bc1c\",\"javascript-design-model_command-mode.md\":\"322eb59e\",\"javascript-design-model_decorator-mode.md\":\"27bb6fdf\",\"javascript-design-model_design-principles.md\":\"b8bfceaa\",\"javascript-design-model_es6.md\":\"34e7517c\",\"javascript-design-model_factory-mode.md\":\"b8fac25a\",\"javascript-design-model_flyweight-mode.md\":\"bb0aea95\",\"javascript-design-model_index.md\":\"0d658c7e\",\"javascript-design-model_inheritance-and-prototype-chain.md\":\"c0e9b193\",\"javascript-design-model_iterator-mode.md\":\"b46a292d\",\"javascript-design-model_mediator-mode.md\":\"d2a37750\",\"javascript-design-model_middleware.md\":\"0a515f26\",\"javascript-design-model_module-mode.md\":\"7dcb8972\",\"javascript-design-model_outward-mode.md\":\"b2536fd8\",\"javascript-design-model_proxy-mode.md\":\"8a69a970\",\"javascript-design-model_published-subscribe-mode.md\":\"09d65501\",\"javascript-design-model_single-mode.md\":\"008157b3\",\"javascript-design-model_state-mode.md\":\"ddb5a0b2\",\"javascript-design-model_strategy-mode.md\":\"27b99bcc\",\"javascript-design-model_template-method-mode.md\":\"f7747b54\",\"javascript-design-model_this.md\":\"6efa7120\",\"road-to-react-chinese_contributor.md\":\"4100a143\",\"road-to-react-chinese_foreword.md\":\"f85896db\",\"road-to-react-chinese_glossar.md\":\"4a86428f\",\"road-to-react-chinese_index.md\":\"58e4c0f8\",\"road-to-react-chinese_intro.md\":\"2e52a2df\",\"road-to-react-chinese_outline.md\":\"e8531bf6\",\"road-to-react-chinese_react-deploy_build.md\":\"a79fb549\",\"road-to-react-chinese_react-deploy_firebase.md\":\"d8c7208c\",\"road-to-react-chinese_react-legacy_class-components-state.md\":\"f62dd36f\",\"road-to-react-chinese_react-legacy_class-components.md\":\"2b1a3b31\",\"road-to-react-chinese_react-legacy_imperative-react.md\":\"a5e21611\",\"road-to-react-chinese_react-maintenance_performance.md\":\"515e4dde\",\"road-to-react-chinese_react-maintenance_project-structure.md\":\"a065fe71\",\"road-to-react-chinese_react-maintenance_testing.md\":\"8cdd91a1\",\"road-to-react-chinese_react-maintenance_typescript.md\":\"e890684f\",\"road-to-react-chinese_react-modern-advanced_paginated-fetch.md\":\"a9bae9f1\",\"road-to-react-chinese_react-modern-advanced_remember-last-searches.md\":\"4a9452ea\",\"road-to-react-chinese_react-modern-advanced_reverse-sort.md\":\"e1cd529d\",\"road-to-react-chinese_react-modern-advanced_sorting.md\":\"ffd943c3\",\"road-to-react-chinese_react-modern_advanced-state.md\":\"08fed6f0\",\"road-to-react-chinese_react-modern_async-await.md\":\"261fc7d6\",\"road-to-react-chinese_react-modern_asynchronous-data.md\":\"6bd22a0d\",\"road-to-react-chinese_react-modern_callback-handlers.md\":\"4da7c008\",\"road-to-react-chinese_react-modern_component-composition.md\":\"a3e12dc6\",\"road-to-react-chinese_react-modern_component-definition.md\":\"f9ee93fd\",\"road-to-react-chinese_react-modern_component-instantiation.md\":\"2c8470b9\",\"road-to-react-chinese_react-modern_conditional-rendering.md\":\"b53353ea\",\"road-to-react-chinese_react-modern_controlled-components.md\":\"17ac14d0\",\"road-to-react-chinese_react-modern_custom-hooks.md\":\"edd6512f\",\"road-to-react-chinese_react-modern_data-fetching.md\":\"37d8a484\",\"road-to-react-chinese_react-modern_data-re-fetching.md\":\"5427c9c0\",\"road-to-react-chinese_react-modern_explicit-data-fetching.md\":\"ba3b64a8\",\"road-to-react-chinese_react-modern_forms.md\":\"7369ffda\",\"road-to-react-chinese_react-modern_fragments.md\":\"699117a5\",\"road-to-react-chinese_react-modern_handler-function.md\":\"c7be09dd\",\"road-to-react-chinese_react-modern_hello-react.md\":\"63cdf2e7\",\"road-to-react-chinese_react-modern_imperative.md\":\"95666e2c\",\"road-to-react-chinese_react-modern_impossible-state.md\":\"a3a722c8\",\"road-to-react-chinese_react-modern_inline-handler.md\":\"43565c65\",\"road-to-react-chinese_react-modern_jsx.md\":\"8c003cb8\",\"road-to-react-chinese_react-modern_lifting-state.md\":\"c6e055b4\",\"road-to-react-chinese_react-modern_lists.md\":\"02325e89\",\"road-to-react-chinese_react-modern_meet-another-react-component.md\":\"47963006\",\"road-to-react-chinese_react-modern_meet-the-react-component.md\":\"38658307\",\"road-to-react-chinese_react-modern_memoized-handler.md\":\"1601c0f3\",\"road-to-react-chinese_react-modern_props-handling.md\":\"a9e60f64\",\"road-to-react-chinese_react-modern_props.md\":\"1f4d3396\",\"road-to-react-chinese_react-modern_react-dom.md\":\"c60cdf17\",\"road-to-react-chinese_react-modern_requirements.md\":\"2799d650\",\"road-to-react-chinese_react-modern_reusable-components.md\":\"bd19d256\",\"road-to-react-chinese_react-modern_setup.md\":\"025acee2\",\"road-to-react-chinese_react-modern_side-effects.md\":\"e84d75d5\",\"road-to-react-chinese_react-modern_state.md\":\"8c63d64b\",\"road-to-react-chinese_react-modern_third-party-libraries.md\":\"67882b95\",\"road-to-react-chinese_react-styling_css-modules.md\":\"ce368b38\",\"road-to-react-chinese_react-styling_css.md\":\"78d65bd9\",\"road-to-react-chinese_react-styling_styled-components.md\":\"7a460278\",\"road-to-react-chinese_react-styling_svg.md\":\"180ce90b\",\"start_index.md\":\"6bb4fcb4\"}")</script>
    <script type="module" async src="/vitepress-demo/assets/app.ee052c02.js"></script>
    
  </body>
</html>